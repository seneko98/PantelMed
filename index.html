<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PantelMed AI - Діагностика здоров'я</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #1a1a1a);
            color: var(--tg-theme-text-color, #ffffff);
            line-height: 1.4;
            font-size: 16px;
        }

        .app {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .hidden {
            display: none;
        }

        /* Кнопка назад */
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background-color: var(--tg-theme-button-color, #0088cc);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .back-button:hover {
            background-color: #0077bb;
            transform: scale(1.1);
        }

        .back-button.hidden {
            display: none;
        }

        /* Головне меню - оновлене брендування */
        .app-branding {
            text-align: center;
            margin-bottom: 40px;
        }

        .app-title {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 5px;
            background: linear-gradient(45deg, #0088cc, #00aaff, #4fc3f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0, 136, 204, 0.3);
        }

        .app-subtitle {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #999);
            font-weight: 400;
            letter-spacing: 0.5px;
            line-height: 1.3;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .menu-item {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            padding: 20px 15px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .menu-item:hover {
            background-color: var(--tg-theme-button-color, #0088cc);
            transform: translateY(-2px);
        }

        .menu-item.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .menu-icon {
            font-size: 32px;
            display: block;
            margin-bottom: 8px;
        }

        .menu-title {
            font-size: 13px;
            font-weight: 600;
        }

        .coming-soon {
            font-size: 10px;
            color: var(--tg-theme-hint-color, #999);
            display: block;
            margin-top: 4px;
        }

        /* Форма профілю */
        .profile-form {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--tg-theme-text-color, #ffffff);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--tg-theme-button-color, #0088cc);
            border-radius: 8px;
            background-color: var(--tg-theme-bg-color, #1a1a1a);
            color: var(--tg-theme-text-color, #ffffff);
            font-size: 16px;
        }

        /* Тест */
        .progress-bar {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            height: 8px;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            height: 100%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-bottom: 10px;
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999);
        }

        .block-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .block-title {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .block-description {
            color: var(--tg-theme-hint-color, #999);
            font-size: 14px;
        }

        .question-block {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .question-counter {
            background-color: var(--tg-theme-button-color, #0088cc);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 16px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .answer-button {
            background-color: var(--tg-theme-bg-color, #1a1a1a);
            border: 2px solid var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-text-color, #ffffff);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .answer-button:hover {
            background-color: var(--tg-theme-button-color, #0088cc);
        }

        .answer-button.selected {
            background-color: var(--tg-theme-button-color, #0088cc);
            border-color: #4caf50;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background-color: var(--tg-theme-bg-color, #1a1a1a);
            border-radius: 8px;
            cursor: pointer;
        }

        .checkbox-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        /* Кнопки */
        .continue-button {
            width: 100%;
            background: linear-gradient(45deg, #4caf50, #45a049);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .continue-button:hover {
            transform: translateY(-2px);
        }

        .continue-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .secondary-button {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            color: var(--tg-theme-text-color, #ffffff);
            border: 1px solid var(--tg-theme-button-color, #0088cc);
        }

        .back-to-menu {
            width: 100%;
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            color: var(--tg-theme-text-color, #ffffff);
            border: 1px solid var(--tg-theme-button-color, #0088cc);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
        }

        /* Результати */
        .results-container {
            margin-bottom: 30px;
        }

        .user-info {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-item {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .result-name {
            font-weight: 600;
        }

        .result-percentage {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .result-percentage.good {
            background-color: #4caf50;
            color: white;
        }

        .result-percentage.warning {
            background-color: #ff9800;
            color: white;
        }

        .result-percentage.danger {
            background-color: #f44336;
            color: white;
        }

        .score-bar-small {
            background-color: var(--tg-theme-bg-color, #1a1a1a);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .score-fill.good {
            background-color: #4caf50;
        }

        .score-fill.warning {
            background-color: #ff9800;
        }

        .score-fill.danger {
            background-color: #f44336;
        }

        /* Selling texts */
        .selling-text {
            background-color: var(--tg-theme-bg-color, #1a1a1a);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #ff6b6b;
        }

        .selling-text h5 {
            color: #ff6b6b;
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .selling-text p {
            margin: 0 0 10px 0;
            font-size: 13px;
            line-height: 1.4;
            color: var(--tg-theme-text-color, #ffffff);
        }

        .basic-practices {
            margin: 10px 0;
        }

        .basic-practices strong {
            display: block;
            margin-bottom: 5px;
            color: var(--tg-theme-text-color, #ffffff);
            font-size: 12px;
        }

        .basic-practices ul {
            margin: 0;
            padding-left: 15px;
            color: var(--tg-theme-hint-color, #999);
        }

        .basic-practices li {
            margin-bottom: 3px;
            font-size: 12px;
        }

        .upgrade-cta {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }

        .upgrade-cta p {
            color: white;
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .upgrade-cta-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Processing animation */
        .processing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .processing-overlay.visible {
            opacity: 1;
        }

        .processing-card {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            max-width: 300px;
        }

        .processing-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--tg-theme-button-color, #0088cc);
            border-top: 4px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .processing-text {
            font-size: 16px;
            margin-bottom: 15px;
            color: var(--tg-theme-text-color, #ffffff);
        }

        .processing-dots {
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .processing-dots span {
            width: 8px;
            height: 8px;
            background-color: var(--tg-theme-button-color, #0088cc);
            border-radius: 50%;
            animation: bounce 1.4s ease-in-out infinite both;
        }

        .processing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .processing-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { 
                transform: scale(0);
            } 40% { 
                transform: scale(1);
            }
        }

        /* Фармакологія */
        .pharma-section {
            padding: 20px 0;
        }

        .pharma-warning {
            background-color: rgba(244, 67, 54, 0.1);
            border: 1px solid #f44336;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .pharma-warning h3 {
            margin: 0 0 10px 0;
            color: #f44336;
        }

        .pharma-warning p {
            margin: 0;
            color: var(--tg-theme-text-color, #ffffff);
            font-size: 14px;
        }

        .course-card {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #ff9800;
            margin-bottom: 15px;
        }

        .course-card h4 {
            color: #ff9800;
            margin-bottom: 10px;
        }

        .course-card ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .course-card li {
            margin-bottom: 5px;
            font-size: 14px;
        }

        .course-price {
            font-weight: bold;
            color: #4caf50;
            font-size: 18px;
        }

        /* Questionnaire */
        .questionnaire-option {
            background-color: var(--tg-theme-bg-color, #1a1a1a);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .questionnaire-option:hover {
            background-color: var(--tg-theme-button-color, #0088cc);
        }

        .questionnaire-option.selected {
            background-color: var(--tg-theme-button-color, #0088cc);
            border-color: #4caf50;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .app {
                padding: 10px;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .back-button {
                top: 10px;
                left: 10px;
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Кнопка назад -->
        <button id="backButton" class="back-button hidden" onclick="goBack()">
            ←
        </button>

        <!-- Головне меню -->
        <div id="menu-screen" class="screen">
            <div class="app-branding">
                <h1 class="app-title">PantelMed AI</h1>
                <p class="app-subtitle">Medical Diagnostic and Preventive Platform on Telegram</p>
            </div>

            <div class="menu-grid">
                <div class="menu-item" onclick="handleMenuClick('test')">
                    <span class="menu-icon">🧬</span>
                    <span class="menu-title">Тест оцінка систем здоров'я</span>
                </div>

                <div class="menu-item" onclick="handleMenuClick('cabinet')">
                    <span class="menu-icon">👤</span>
                    <span class="menu-title">Мій кабінет</span>
                </div>

                <div class="menu-item" onclick="handleMenuClick('diet')">
                    <span class="menu-icon">🥗</span>
                    <span class="menu-title">Персональна дієта</span>
                </div>

                <div class="menu-item" onclick="handleMenuClick('pharma')">
                    <span class="menu-icon">💊💉</span>
                    <span class="menu-title">Фарма</span>
                </div>

                <div class="menu-item" onclick="handleMenuClick('consultation')">
                    <span class="menu-icon">👨‍⚕️</span>
                    <span class="menu-title">Запис на консультацію</span>
                </div>

                <div class="menu-item disabled">
                    <span class="menu-icon">📊</span>
                    <span class="menu-title">Інтерпретація аналізів</span>
                    <span class="coming-soon">Скоро</span>
                </div>
            </div>
        </div>

        <!-- Екран профілю -->
        <div id="profile-screen" class="screen hidden">
            <div class="block-header">
                <h2>👤 Персональні дані</h2>
                <p>Для точної діагностики потрібні ваші дані</p>
            </div>

            <div class="profile-form">
                <div class="form-group">
                    <label for="userName">Ім'я:</label>
                    <input type="text" id="userName" placeholder="Введіть ваше ім'я">
                </div>

                <div class="form-group">
                    <label for="userAge">Вік:</label>
                    <select id="userAge">
                        <option value="">Оберіть вік</option>
                        <option value="18-25">18-25 років</option>
                        <option value="26-35">26-35 років</option>
                        <option value="36-45">36-45 років</option>
                        <option value="46-55">46-55 років</option>
                        <option value="56+">56+ років</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="userGender">Стать:</label>
                    <select id="userGender">
                        <option value="">Оберіть стать</option>
                        <option value="male">Чоловік</option>
                        <option value="female">Жінка</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="userBodyType">Статура:</label>
                    <select id="userBodyType">
                        <option value="">Оберіть статуру</option>
                        <option value="thin">Худа</option>
                        <option value="normal">Нормальна</option>
                        <option value="athletic">Спортивна</option>
                        <option value="overweight">Повна</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="userHeight">Зріст (см):</label>
                    <input type="number" id="userHeight" placeholder="170" min="100" max="250">
                </div>

                <div class="form-group">
                    <label for="userWeight">Вага (кг):</label>
                    <input type="number" id="userWeight" placeholder="70" min="30" max="200">
                </div>
            </div>

            <button class="continue-button" onclick="startTestQuestions()" disabled>
                Почати тестування 🚀
            </button>
        </div>

        <!-- Екран тесту -->
        <div id="test-screen" class="screen hidden">
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <div id="progressText" class="progress-text"></div>

            <div class="block-header">
                <h2 id="blockTitle"></h2>
                <p id="blockDescription"></p>
            </div>

            <div id="questionsContainer"></div>

            <button id="nextButton" class="continue-button" onclick="nextBlockWithProcessing()" disabled>
                Далі ➡️
            </button>
        </div>

        <!-- Екран результатів -->
        <div id="results-screen" class="screen hidden">
            <div class="block-header">
                <h2>📊 Результати діагностики</h2>
            </div>

            <div id="userInfoResults" class="user-info"></div>
            <div id="allResults" class="results-container"></div>

            <button onclick="backToMenu()" class="back-to-menu">
                🏠 Повернутися до меню
            </button>
        </div>
    </div>

    <script>
        // Telegram WebApp ініціалізація
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.expand();
            tg.ready();
        }

        // Глобальні змінні
        let currentScreen = 'menu';
        let currentBlock = 0;
        let answers = {};
        let userProfile = {};
        let userTestResults = null;
        let testCompletionDate = null;
        let navigationHistory = [];

        // Блоки здоров'я
        const healthBlocks = {
            serotonin: {
                name: 'Серотонін',
                emoji: '😌',
                title: '😌 СЕРОТОНІН - гормон щастя',
                description: 'рівень серотоніну впливає на настрій, сон та загальне самопочуття',
                type: 'neurotransmitter',
                questions: [
                    { id: 'ser_1', text: 'Чи часто відчуваєте пригніченість або сум без видимих причин?' },
                    { id: 'ser_2', text: 'Чи важко вам заснути або ви прокидаєтесь вночі?' },
                    { id: 'ser_3', text: 'Чи відчуваєте тривогу в повсякденних ситуаціях?' },
                    { id: 'ser_4', text: 'Чи маєте сильну тягу до солодкого або вуглеводів?' },
                    { id: 'ser_5', text: 'Чи втратили інтерес до занять, які раніше приносили задоволення?' }
                ]
            },
            dopamine: {
                name: 'Дофамін',
                emoji: '🎯',
                title: '🎯 ДОФАМІН - мотивація та винагорода',
                description: 'дофамін відповідає за мотивацію, енергію та відчуття задоволення',
                type: 'neurotransmitter',
                questions: [
                    { id: 'dop_1', text: 'Чи відчуваєте брак мотивації або енергії для повсякденних завдань?' },
                    { id: 'dop_2', text: 'Чи важко вам зосередитися на роботі або навчанні?' },
                    { id: 'dop_3', text: 'Чи шукаєте постійну стимуляцію (соцмережі, відео, їжа)?' },
                    { id: 'dop_4', text: 'Чи відчуваєте, що втратили здатність радіти простим речам?' },
                    { id: 'dop_5', text: 'Чи часто відкладаєте важливі справи на потім?' }
                ]
            },
            digestive_system: {
                name: 'Шлунково-кишковий тракт',
                emoji: '🍽️',
                title: '🍽️ ШКТ - "другий мозок"',
                description: 'шлунково-кишковий тракт виробляє 80% серотоніну',
                type: 'system',
                questions: [
                    { id: 'dig_1', text: 'Чи маєте проблеми з травленням (здуття, гази, дискомфорт)?' },
                    { id: 'dig_2', text: 'Чи нерегулярний стілець (запори або діарея)?' },
                    { id: 'dig_3', text: 'Чи відчуваєте печію або кислотність?' },
                    { id: 'dig_4', text: 'Чи маєте пищевою непереносимість або алергії?' },
                    { id: 'dig_5', text: 'Чи часто приймали антибіотики останнім часом?' }
                ]
            },
            rectal_parasites: {
                name: 'Задній прохід та гельмінти',
                emoji: '🧻',
                title: '🧻 ЗАДНІЙ ПРОХІД ТА ГЕЛЬМІНТИ - інтимне здоров\'я',
                description: 'стан заднього проходу та наявність паразитів впливають на загальне здоров\'я',
                type: 'medical',
                questions: [
                    { 
                        id: 'rec_1', 
                        text: 'Чи проводите ви час із телефоном у руках, сидячи в туалеті?',
                        type: 'multiple_choice',
                        options: [
                            { text: 'Так', score: 0 },
                            { text: 'Інколи', score: 1 },
                            { text: 'Ні', score: 2 }
                        ]
                    },
                    { 
                        id: 'rec_2', 
                        text: 'Чи доводиться вам тужитись перед початком дефекації?',
                        type: 'multiple_choice',
                        options: [
                            { text: 'Часто', score: 0 },
                            { text: 'Інколи', score: 1 },
                            { text: 'Ні', score: 2 }
                        ]
                    },
                    { id: 'rec_3', text: 'Чи відчуваєте ви біль у ділянці заднього проходу у звичайному житті або при ходьбі?' },
                    { id: 'rec_4', text: 'Чи є у вас біль під час або після дефекації?' },
                    { id: 'rec_5', text: 'Чи маєте ви домашніх тварин?' },
                    { id: 'rec_6', text: 'Чи контактуєте з вуличними тваринами (гладите, підгодовуєте)?' },
                    { id: 'rec_7', text: 'Чи миєте ви овочі та фрукти перед споживанням?' },
                    { id: 'rec_8', text: 'Чи протираєте ви свій телефон антисептиком або вологими серветками хоча б раз на добу?' }
                ]
            },
            activity: {
                name: 'Рівень щоденної активності',
                emoji: '🚶‍♂️',
                title: '🚶‍♂️ АКТИВНІСТЬ - рух це життя',
                description: 'фізична активність впливає на всі системи організму',
                type: 'lifestyle',
                questions: [
                    { 
                        id: 'act_1', 
                        text: 'Скільки ви зазвичай проходите кроків на день?',
                        type: 'multiple_choice',
                        options: [
                            { text: 'Менше 1 000 кроків (сидячий спосіб життя)', score: 0 },
                            { text: 'Від 1 000 до 5 000 кроків (легка активність)', score: 1 },
                            { text: 'Від 5 000 до 10 000 і більше (активний спосіб життя)', score: 2 }
                        ]
                    },
                    { 
                        id: 'act_2', 
                        text: 'Скільки годин на день ви проводите в сидячому положенні?',
                        type: 'multiple_choice',
                        options: [
                            { text: '2-4 години (норма)', score: 2 },
                            { text: '5-7 годин (середньо)', score: 1 },
                            { text: '8+ годин (критично)', score: 0 }
                        ]
                    },
                    { id: 'act_3', text: 'Чи займаєтесь ви регулярними фізичними вправами?' },
                    { id: 'act_4', text: 'Чи відчуваєте ви задишку при підйомі на 2-3 поверх?' },
                    { id: 'act_5', text: 'Чи користуєтесь ви ліфтом замість сходів?' }
                ]
            },
            nutrition: {
                name: 'Базове харчування',
                emoji: '🍎',
                title: '🍎 ХАРЧУВАННЯ - основа здоров\'я',
                description: 'якість харчування визначає енергію, настрій та довголіття',
                type: 'lifestyle',
                questions: [
                    { 
                        id: 'nut_1', 
                        text: 'Як часто ви споживаєте білок (м\'ясо, яйця, молочка, риба)?',
                        type: 'multiple_choice',
                        options: [
                            { text: 'Декілька разів на день (м\'ясо, яйця, молочка, риба)', score: 2 },
                            { text: '1 раз на день', score: 1 },
                            { text: 'Рідко (менше 4 разів на тиждень)', score: 0 }
                        ]
                    },
                    { 
                        id: 'nut_3', 
                        text: 'Як часто ви їсте солодке / доданий цукор (печиво, цукерки, десерти)?',
                        type: 'multiple_choice',
                        options: [
                            { text: 'Не їм', score: 2 },
                            { text: 'Інколи', score: 1 },
                            { text: 'Щодня / кілька разів на день', score: 0 }
                        ]
                    }
                ]
            },
            chronic: {
                name: 'Хронічні хвороби',
                emoji: '🏥',
                title: '🏥 ХРОНІЧНІ ЗАХВОРЮВАННЯ - вплив на загальне здоров\'я',
                description: 'наявність хронічних захворювань впливає на всі системи організму',
                type: 'medical',
                questions: [
                    { 
                        id: 'chr_1', 
                        text: 'Чи є у вас діагностовані хронічні захворювання?',
                        type: 'multiple_select',
                        options: [
                            { text: 'Простатит / проблеми з простатою', value: 'prostatitis' },
                            { text: 'Хронічний тонзиліт / часті ангіни', value: 'tonsillitis' },
                            { text: 'Хронічні утруднення дихання / астма', value: 'breathing' },
                            { text: 'Грижі, протрузії хребта', value: 'spine' },
                            { text: 'Артрити, артрози суглобів', value: 'joints' },
                            { text: 'Печінка (гепатоз, гепатит, синдром Жільбера)', value: 'liver' },
                            { text: 'Нирки / сечовидільна система (цистит, пієлонефрит)', value: 'kidneys' },
                            { text: 'Серцево-судинна система (гіпертонія, аритмія, ішемія)', value: 'cardio' },
                            { text: 'Аутоімунні захворювання (тиреоїдит, псоріаз)', value: 'autoimmune' },
                            { text: 'ШКТ (хронічний гастрит, коліт, Хелікобактер)', value: 'git' },
                            { text: 'Немає хронічних захворювань', value: 'none' }
                        ]
                    }
                ]
            }
        };

        // Продающі тексти для систем
        const systemSellingTexts = {
            serotonin: {
                title: "😌 Серотонін - твоє щастя під контролем",
                text: "Серотонін дає нам звичайний рівень радості, впливає на ментальне самопочуття, щастя і задоволення від життя. Не кради в себе щастя! При низькому серотоніні швидко відбувається акт еякуляції під час сексу.",
                practices: ["Не читай погані новини", "Більше сонця та вітаміну D3", "Триптофан з їжі", "Медитація та вдячність"]
            },
            dopamine: {
                title: "🎯 Дофамін - твій внутрішній двигун",
                text: "Дофамін - це те, що нас запалює! Він понижає пролактин, підвищує сексуальне бажання. Успіх в житті напряму залежить від рівня дофаміну.",
                practices: ["Ставити та досягати маленькі цілі", "Займатись спортом", "Обмежити швидкі задоволення", "Здорова конкуренція"]
            },
            digestive_system: {
                title: "🍽️ ШКТ - твій другий мозок",
                text: "80% серотоніну виробляється в кишечнику! ШКТ - це наш другий мозок, який контролює настрій, імунітет та загальне самопочуття.",
                practices: ["Пробіотики", "Клітковина щодня", "Відмова від солодкого", "Якісна вода"]
            },
            rectal_parasites: {
                title: "🧻 Задній прохід та паразити - інтимне здоров'я",
                text: "Здоров'я заднього проходу та відсутність паразитів критично важливі для якості життя. Часте сидіння з телефоном → застій крові → геморой. Паразити → погане засвоєння поживних речовин → виснаження.",
                practices: ["Біде замість туалетного паперу", "Обмеження часу в туалеті", "Регулярна дегельмінтизація", "Гігієна рук та телефону"]
            }
        };

        // Функції навігації
        function goBack() {
            if (navigationHistory.length > 0) {
                const previousScreen = navigationHistory.pop();
                showScreen(previousScreen, false);
            } else {
                showScreen('menu-screen', false);
            }
        }

        function showScreen(screenId, addToHistory = true) {
            if (addToHistory && currentScreen !== 'menu') {
                navigationHistory.push(currentScreen + '-screen');
            }
            
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.remove('hidden');
            }
            
            currentScreen = screenId.replace('-screen', '');
            
            // Показати/сховати кнопку назад
            const backButton = document.getElementById('backButton');
            if (currentScreen === 'menu') {
                backButton.classList.add('hidden');
            } else {
                backButton.classList.remove('hidden');
            }
            
            setTimeout(() => scrollToTop(false), 100);
        }

        function scrollToTop(smooth = true) {
            if (smooth) {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            } else {
                window.scrollTo(0, 0);
            }
        }

        function handleMenuClick(menuId) {
            switch(menuId) {
                case 'test':
                    if (hasCompletedTest() && !canRetakeTest()) {
                        showRetakeWarning();
                    } else {
                        startTest();
                    }
                    break;
                case 'cabinet':
                    if (hasCompletedTest()) {
                        showMyCabinet();
                    } else {
                        alert('Спочатку пройдіть тест для створення особистого кабінету!');
                    }
                    break;
                case 'diet':
                    showDietSection();
                    break;
                case 'pharma':
                    showPharmaSection();
                    break;
                case 'consultation':
                    showConsultationSection();
                    break;
                default:
                    showComingSoon(menuId);
            }
        }

        function startTest() {
            showScreen('profile-screen');
        }

        function startTestQuestions() {
            userProfile = {
                name: document.getElementById('userName').value,
                age: document.getElementById('userAge').value,
                gender: document.getElementById('userGender').value,
                bodyType: document.getElementById('userBodyType').value,
                height: document.getElementById('userHeight').value,
                weight: document.getElementById('userWeight').value
            };

            if (!userProfile.name || !userProfile.age || !userProfile.gender || 
                !userProfile.bodyType || !userProfile.height || !userProfile.weight) {
                alert('Будь ласка, заповніть всі поля!');
                return;
            }

            currentBlock = 0;
            answers = {};
            showScreen('test-screen');
            showTestBlock();
        }

        function getAvailableBlocks() {
            const blocks = [];
            
            Object.entries(healthBlocks).forEach(([key, block]) => {
                if (block.genderSpecific) {
                    if (block.genderSpecific === userProfile.gender) {
                        blocks.push([key, block]);
                    }
                } else {
                    blocks.push([key, block]);
                }
            });
            
            return blocks;
        }

        function showTestBlock() {
            const availableBlocks = getAvailableBlocks();
            
            if (currentBlock >= availableBlocks.length) {
                showResults();
                return;
            }

            const [blockKey, blockData] = availableBlocks[currentBlock];
            
            const progress = ((currentBlock + 1) / availableBlocks.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `📍 Прогрес: ${currentBlock + 1}/${availableBlocks.length}`;
            
            document.getElementById('blockTitle').textContent = blockData.title;
            document.getElementById('blockDescription').textContent = blockData.description;
            
            const filteredQuestions = blockData.questions.filter(q => 
                !q.genderSpecific || q.genderSpecific === userProfile.gender
            );
            
            const questionsContainer = document.getElementById('questionsContainer');
            questionsContainer.innerHTML = '';
            
            filteredQuestions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-block';
                
                let optionsHTML = '';
                
                if (question.type === 'multiple_choice') {
                    optionsHTML = question.options.map(option => `
                        <button class="answer-button" onclick="selectAnswer('${question.id}', ${option.score})" 
                                data-question="${question.id}" data-value="${option.score}">
                            ${option.text}
                        </button>
                    `).join('');
                } else if (question.type === 'multiple_select') {
                    optionsHTML = question.options.map(option => `
                        <label class="checkbox-option">
                            <input type="checkbox" value="${option.value}" 
                                   onchange="handleMultipleSelect('${question.id}', '${option.value}', this.checked)">
                            <span>${option.text}</span>
                        </label>
                    `).join('');
                } else {
                    optionsHTML = `
                        <button class="answer-button" onclick="selectAnswer('${question.id}', 0)" 
                                data-question="${question.id}" data-value="0">Так</button>
                        <button class="answer-button" onclick="selectAnswer('${question.id}', 1)" 
                                data-question="${question.id}" data-value="1">Інколи</button>
                        <button class="answer-button" onclick="selectAnswer('${question.id}', 2)" 
                                data-question="${question.id}" data-value="2">Ні</button>
                    `;
                }
                
                questionDiv.innerHTML = `
                    <div class="question-counter">Питання ${index + 1}/${filteredQuestions.length}</div>
                    <p class="question-text">${question.text}</p>
                    <div class="answer-options">${optionsHTML}</div>
                `;
                questionsContainer.appendChild(questionDiv);
            });
            
            const nextButton = document.getElementById('nextButton');
            nextButton.textContent = currentBlock === availableBlocks.length - 1 ? 'Завершити тест 🎯' : 'Далі ➡️';
            nextButton.disabled = true;
            
            checkAllAnswered();
        }

        function selectAnswer(questionId, value) {
            answers[questionId] = value;
            
            const buttons = document.querySelectorAll(`[data-question="${questionId}"]`);
            buttons.forEach(btn => btn.classList.remove('selected'));
            
            const selectedButton = document.querySelector(`[data-question="${questionId}"][data-value="${value}"]`);
            if (selectedButton) {
                selectedButton.classList.add('selected');
            }
            
            checkAllAnswered();
        }

        function handleMultipleSelect(questionId, value, checked) {
            if (!answers[questionId]) {
                answers[questionId] = [];
            }
            
            if (value === 'none') {
                answers[questionId] = checked ? ['none'] : [];
                const otherCheckboxes = document.querySelectorAll(`input[type="checkbox"]:not([value="none"])`);
                otherCheckboxes.forEach(cb => cb.checked = false);
            } else {
                if (checked) {
                    answers[questionId] = answers[questionId].filter(v => v !== 'none').concat(value);
                } else {
                    answers[questionId] = answers[questionId].filter(v => v !== value);
                }
                const noneCheckbox = document.querySelector(`input[value="none"]`);
                if (noneCheckbox) noneCheckbox.checked = false;
            }
            
            checkAllAnswered();
        }

        function checkAllAnswered() {
            const availableBlocks = getAvailableBlocks();
            const [blockKey, blockData] = availableBlocks[currentBlock];
            
            const filteredQuestions = blockData.questions.filter(q => 
                !q.genderSpecific || q.genderSpecific === userProfile.gender
            );
            
            const allAnswered = filteredQuestions.every(q => {
                if (q.type === 'multiple_select') {
                    return answers[q.id] && answers[q.id].length > 0;
                }
                return answers[q.id] !== undefined;
            });
            
            document.getElementById('nextButton').disabled = !allAnswered;
        }

        function showProcessingMessage(message, duration = 2000) {
            return new Promise((resolve) => {
                scrollToTop();
                
                const overlay = document.createElement('div');
                overlay.className = 'processing-overlay';
                overlay.innerHTML = `
                    <div class="processing-card">
                        <div class="processing-spinner"></div>
                        <p class="processing-text">${message}</p>
                        <div class="processing-dots">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(overlay);
                
                setTimeout(() => {
                    overlay.classList.add('visible');
                }, 100);
                
                setTimeout(() => {
                    overlay.classList.remove('visible');
                    setTimeout(() => {
                        if (overlay.parentNode) {
                            overlay.parentNode.removeChild(overlay);
                        }
                        resolve();
                    }, 300);
                }, duration);
            });
        }

        async function nextBlockWithProcessing() {
            scrollToTop();
            
            const processingMsgs = ['🧠 Аналізую відповіді...', '📊 Обробляю дані...'];
            for (let i = 0; i < processingMsgs.length; i++) {
                await showProcessingMessage(processingMsgs[i], 800);
                if (i < processingMsgs.length - 1) {
                    await new Promise(r => setTimeout(r, 150));
                }
            }
            
            currentBlock++;
            
            if (currentBlock >= getAvailableBlocks().length) {
                const finalMessages = ['📊 Завершую аналіз...', '🎯 Формую результати...'];
                for (let i = 0; i < finalMessages.length; i++) {
                    await showProcessingMessage(finalMessages[i], 1000);
                    if (i < finalMessages.length - 1) {
                        await new Promise(r => setTimeout(r, 150));
                    }
                }
                showResults();
            } else {
                showTestBlock();
                setTimeout(() => scrollToTop(), 300);
            }
        }

        function showResults() {
            showScreen('results-screen');
            scrollToTop(false);
            calculateAndDisplayResults();
        }

        function calculateAndDisplayResults() {
            const results = {};
            const availableBlocks = getAvailableBlocks();
            
            availableBlocks.forEach(([key, data]) => {
                let score = 0;
                let maxScore = 0;
                
                const filteredQuestions = data.questions.filter(q => 
                    !q.genderSpecific || q.genderSpecific === userProfile.gender
                );
                
                filteredQuestions.forEach(q => {
                    if (q.type === 'multiple_select') {
                        maxScore += 2;
                        const selectedValues = answers[q.id] || [];
                        score += (selectedValues.length === 0 || selectedValues.includes('none')) ? 2 : 0;
                    } else {
                        maxScore += 2;
                        score += answers[q.id] || 0;
                    }
                });
                
                const percentage = Math.round((score / maxScore) * 100);
                
                results[key] = {
                    score,
                    maxScore,
                    percentage: Math.min(percentage, 85),
                    ...data
                };
            });

            const bmi = userProfile.weight && userProfile.height 
                ? (userProfile.weight / Math.pow(userProfile.height / 100, 2)).toFixed(1)
                : null;

            const userInfoHTML = `
                <h3>👤 ${userProfile.name}</h3>
                <p>Вік: ${userProfile.age} | Стать: ${userProfile.gender === 'male' ? 'Чоловік' : 'Жінка'}</p>
                ${bmi ? `<p>ІМТ: ${bmi} (${getBMICategory(bmi)})</p>` : ''}
            `;
            document.getElementById('userInfoResults').innerHTML = userInfoHTML;

            let allResultsHTML = '<h3>📊 Детальні результати:</h3>';
            
            Object.entries(results).forEach(([key, result]) => {
                const status = getStatusColor(result.percentage);
                allResultsHTML += `
                    <div class="result-item">
                        <div class="result-header">
                            <span class="result-name">${result.emoji} ${result.name}</span>
                            <span class="result-percentage ${status}">${Math.round(result.percentage)}%</span>
                        </div>
                        <div class="score-bar-small">
                            <div class="score-fill ${status}" style="width: ${result.percentage}%"></div>
                        </div>
                        ${result.percentage < 75 ? `
                        <div class="selling-text">
                            ${getSystemSellingText(key) ? `
                                <h5>${getSystemSellingText(key).title}</h5>
                                <p>${getSystemSellingText(key).text}</p>
                                <div class="basic-practices">
                                    <strong>📋 Базові практики:</strong>
                                    <ul>
                                        ${getSystemSellingText(key).practices.map(practice => `<li>${practice}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            <div class="upgrade-cta">
                                <p><strong>💎 Персональні рекомендації та стеки добавок чекають в розширеній версії</strong></p>
                                <button onclick="showUpgradeOffer()" class="upgrade-cta-btn">
                                    Детальніше про ${result.name}
                                </button>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            });

            // Додаємо рекомендацію ГЗТ для чоловіків 45+
            if (userProfile.gender === 'male' && parseInt(userProfile.age?.split('-')[0] || '25') >= 45) {
                allResultsHTML += `
                    <div class="result-item" style="border-left: 4px solid #9c27b0;">
                        <div class="result-header">
                            <span class="result-name">🧬 Рекомендація: ГЗТ</span>
                            <span class="result-percentage warning">Перевірити</span>
                        </div>
                        <div class="selling-text">
                            <h5>🧬 ГЗТ - Гормонозамісна терапія</h5>
                            <p>З віком організм природно знижує вироблення тестостерону. Після 45 років багато чоловіків відчувають: ↓лібідо, ↓енергію, ↓м'язову масу, ↑жир у зоні живота.</p>
                            <div class="basic-practices">
                                <strong>✅ Що дає ГЗТ:</strong>
                                <ul>
                                    <li>Повернення енергії та мотивації</li>
                                    <li>Покращення сексуальної функції</li>
                                    <li>Нормалізація композиції тіла</li>
                                    <li>Підтримка кісткової щільності</li>
                                </ul>
                            </div>
                            <div class="upgrade-cta">
                                <p><strong>💎 Консультація з підбору ГЗТ</strong></p>
                                <a href="https://t.me/vladyslav_kravchukk?text=Хочу консультацію щодо ГЗТ" target="_blank" class="upgrade-cta-btn">
                                    Записатися на консультацію
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            }

            document.getElementById('allResults').innerHTML = allResultsHTML;
            
            saveTestResults(userProfile, answers, results, []);
        }

        function getBMICategory(bmi) {
            if (bmi < 18.5) return 'Недостатня вага';
            if (bmi < 25) return 'Нормальна вага';
            if (bmi < 30) return 'Надмірна вага';
            return 'Ожиріння';
        }

        function getStatusColor(percentage) {
            if (percentage >= 75) return 'good';
            if (percentage >= 50) return 'warning';
            return 'danger';
        }

        function getSystemSellingText(systemKey) {
            return systemSellingTexts[systemKey] || null;
        }

        // Клас для збереження результатів
        class TestResults {
            constructor(userProfile, answers, results, warnings) {
                this.id = Date.now().toString();
                this.completionDate = new Date().toISOString();
                this.userProfile = { ...userProfile };
                this.answers = { ...answers };
                this.results = { ...results };
                this.warnings = warnings || [];
            }
        }

        function saveTestResults(userProfile, answers, results, warnings) {
            userTestResults = new TestResults(userProfile, answers, results, warnings);
            testCompletionDate = new Date();
            return userTestResults;
        }

        function hasCompletedTest() {
            return userTestResults !== null;
        }

        function canRetakeTest() {
            if (!testCompletionDate) return true;
            const daysSinceTest = (Date.now() - testCompletionDate.getTime()) / (1000 * 60 * 60 * 24);
            return daysSinceTest >= 30;
        }

        function showRetakeWarning() {
            alert('Ви вже проходили тест менше місяця тому. Наступний тест можна буде пройти пізніше для більш точних результатів.');
        }

        function showMyCabinet() {
            if (!hasCompletedTest()) {
                alert('Спочатку пройдіть тест для створення особистого кабінету!');
                return;
            }
            
            const cabinetHTML = `
                <div class="cabinet-container">
                    <h2>👤 Мій кабінет</h2>
                    <p>Тест пройдено: ${formatDate(userTestResults.completionDate)}</p>
                    <p>Ваші результати збережені та доступні для перегляду.</p>
                    
                    <div class="course-card">
                        <h4>💊 Персональні стеки добавок</h4>
                        <p>На основі ваших результатів тесту</p>
                        <ul>
                            <li>Індивідуальний підбір добавок</li>
                            <li>Схеми прийому та дозування</li>
                            <li>Кореляції з вашими показниками</li>
                        </ul>
                        <button onclick="showPersonalizedSupplements()" class="continue-button">
                            Переглянути мої стеки
                        </button>
                    </div>
                    
                    <button onclick="showUpgradeOffer()" class="continue-button">
                        💎 Отримати детальний аналіз
                    </button>
                    <button onclick="backToMenu()" class="back-to-menu">
                        🏠 Повернутися до меню
                    </button>
                </div>
            `;
            
            showCustomScreen(cabinetHTML);
        }

        function showPersonalizedSupplements() {
            alert('Персоналізовані стеки добавок доступні в розширеній версії. Звертайтесь до спеціаліста для індивідуального підбору.');
        }

        function formatDate(isoString) {
            const date = new Date(isoString);
            return date.toLocaleDateString('uk-UA');
        }

        function showDietSection() {
            showComingSoon('Персональні дієти');
        }

        function showPharmaSection() {
            const pharmaHTML = `
                <div class="pharma-section">
                    <h2>💊💉 Фармакологія</h2>
                    
                    <div class="pharma-warning">
                        <h3>⚠️ Важливо!</h3>
                        <p>Всі фармакологічні препарати повинні призначатися тільки лікарем після обстеження!</p>
                    </div>
                    
                    <div class="course-card" onclick="showSteroidCourses()">
                        <h4>💉 Стероїдні курси</h4>
                        <p>Інформація виключно для ознайомлення</p>
                        <ul>
                            <li>Персональний підбір курсу</li>
                            <li>Каталог готових курсів</li>
                            <li>Безпека та ПКТ</li>
                        </ul>
                        <div class="course-price">від 900 грн</div>
                    </div>
                    
                    <div class="course-card" onclick="showHRTInfo()">
                        <h4>🧬 ГЗТ - Гормонозамісна терапія</h4>
                        <p>Для відновлення природного рівня гормонів</p>
                        <ul>
                            <li>Протоколи тестостерону</li>
                            <li>Медичний супровід</li>
                            <li>Моніторинг показників</li>
                        </ul>
                        <div class="course-price">Консультація 799 грн</div>
                    </div>
                    
                    <button onclick="backToMenu()" class="back-to-menu">
                        🏠 Повернутися до меню
                    </button>
                </div>
            `;
            
            showCustomScreen(pharmaHTML);
        }

        function showSteroidCourses() {
            const coursesHTML = `
                <div class="steroid-courses-section">
                    <h2>💉 Стероїдні курси</h2>
                    
                    <div class="pharma-warning">
                        <h3>⚠️ КРИТИЧНО ВАЖЛИВО!</h3>
                        <p>Інформація виключно для ознайомлення! Використання анаболічних стероїдів без медичного нагляду небезпечно для здоров'я!</p>
                    </div>
                    
                    <div class="course-selection">
                        <h3>🎯 Оберіть варіант:</h3>
                        
                        <div class="course-card" onclick="showCourseQuestionnaire()">
                            <h4>📋 Персональний підбір курсу</h4>
                            <p>Відповідь на питання для індивідуального підбору</p>
                            <small>Рекомендовано для новачків</small>
                        </div>
                        
                        <div class="course-card" onclick="showAllCourses()">
                            <h4>📖 Переглянути всі курси</h4>
                            <p>Каталог готових курсів з описами</p>
                            <small>Для досвідчених користувачів</small>
                        </div>
                    </div>
                    
                    <div class="upgrade-cta">
                        <p>💬 Для детального підбору та супроводу:</p>
                        <a href="https://t.me/vladyslav_kravchukk" target="_blank" class="upgrade-cta-btn">
                            📱 Консультація спеціаліста
                        </a>
                    </div>
                    
                    <button onclick="showPharmaSection()" class="back-to-menu">
                        ← Назад до фармакології
                    </button>
                </div>
            `;
            
            showCustomScreen(coursesHTML);
        }

        function showCourseQuestionnaire() {
            let currentQuestionIndex = 0;
            let courseAnswers = {};
            
            const questions = [
                {
                    id: 'age',
                    title: 'Ваш вік:',
                    options: [
                        '18-20 років (мінімальні дози)',
                        '21-25 років (стандартні дози)',
                        '26-35 років (повні дози)',
                        '36-40 років (обережні дози)',
                        '40+ років (спеціальні протоколи)'
                    ]
                },
                {
                    id: 'experience',
                    title: 'Досвід з ААС:',
                    options: [
                        '0 (перший курс)',
                        '1-2 курси',
                        '3-5 курсів',
                        'Більше 5 курсів'
                    ]
                },
                {
                    id: 'health',
                    title: 'Стан здоров\'я:',
                    options: [
                        'Алопеція/випадіння волосся',
                        'Проблеми з простатою',
                        'Проблеми з печінкою',
                        'Травми суглобів',
                        'Немає обмежень'
                    ]
                },
                {
                    id: 'goal',
                    title: 'Мета курсу:',
                    options: [
                        'Набір м\'язової маси',
                        'Сушка/рельєф',
                        'Збільшення сили',
                        'Спортивні показники'
                    ]
                }
            ];
            
            function showQuestion(index) {
                if (index >= questions.length) {
                    showCourseRecommendation();
                    return;
                }
                
                const question = questions[index];
                const questionnaireHTML = `
                    <div class="course-questionnaire-section">
                        <h2>📋 Підбір курсу</h2>
                        <p>Питання ${index + 1} з ${questions.length}</p>
                        
                        <div class="course-card">
                            <h4>${question.title}</h4>
                            <div class="questionnaire-options">
                                ${question.options.map((option, optIndex) => `
                                    <div class="questionnaire-option" onclick="selectCourseAnswer('${question.id}', '${option}', ${optIndex})">
                                        ${option}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <button onclick="showSteroidCourses()" class="back-to-menu">
                            ← Назад до курсів
                        </button>
                    </div>
                `;
                
                showCustomScreen(questionnaireHTML);
            }
            
            window.selectCourseAnswer = function(questionId, value, optionIndex) {
                courseAnswers[questionId] = value;
                
                const options = document.querySelectorAll('.questionnaire-option');
                options.forEach(opt => opt.classList.remove('selected'));
                if (options[optionIndex]) {
                    options[optionIndex].classList.add('selected');
                }
                
                setTimeout(() => {
                    currentQuestionIndex++;
                    showQuestion(currentQuestionIndex);
                }, 500);
            };
            
            function showCourseRecommendation() {
                let recommendedCourse = '';
                let price = '';
                let description = '';
                
                if (courseAnswers.experience === '0 (перший курс)') {
                    recommendedCourse = '🥉 Перший курс';
                    price = '1200-3000 грн';
                    description = 'Безпечний старт з мінімальними ризиками';
                } else if (courseAnswers.experience === '1-2 курси') {
                    recommendedCourse = '🥈 Стандартний курс';
                    price = '3200-4000 грн';
                    description = 'Якісний набір для досвідчених';
                } else {
                    recommendedCourse = '🥇 Продвинутий курс';
                    price = '6500+ грн';
                    description = 'Для професіоналів';
                }
                
                const resultHTML = `
                    <div class="course-recommendation">
                        <h2>🎯 Ваша рекомендація</h2>
                        
                        <div class="course-card">
                            <h4>${recommendedCourse}</h4>
                            <p>${description}</p>
                            <div class="course-price">${price}</div>
                        </div>
                        
                        <div class="upgrade-cta">
                            <p><strong>💎 Детальна схема курсу включає:</strong></p>
                            <ul style="text-align: left; color: white;">
                                <li>Точні дозування та графік</li>
                                <li>ПКТ протокол</li>
                                <li>Необхідні аналізи</li>
                                <li>Підтримка печінки</li>
                                <li>Консультація спеціаліста</li>
                            </ul>
                            <a href="https://t.me/vladyslav_kravchukk?text=Хочу детальну схему курсу" target="_blank" class="upgrade-cta-btn">
                                Отримати повну схему
                            </a>
                        </div>
                        
                        <button onclick="showAllCourses()" class="secondary-button">
                            📖 Переглянути інші курси
                        </button>
                        
                        <button onclick="showSteroidCourses()" class="back-to-menu">
                            ← Назад
                        </button>
                    </div>
                `;
                
                showCustomScreen(resultHTML);
            }
            
            showQuestion(0);
        }

        function showAllCourses() {
            const courses = [
                {
                    name: '🥉 ЕКОНОМ: Короткий курс (4 тижні)',
                    price: '900-1500 грн',
                    description: 'Турінабол або Оксанадролон',
                    target: 'Легкий набір, швидкість-сила'
                },
                {
                    name: '🥈 СТАНДАРТ: Тест + таблетки (8 тижнів)',
                    price: '3200-4000 грн',
                    description: 'Тестостерон + Оксанадролон',
                    target: 'Якісний набір, сила'
                },
                {
                    name: '🥇 ПРЕМІУМ: Складний курс (10-12 тижнів)',
                    price: '6500-8000 грн',
                    description: 'Тест + Мастерон + Турінабол',
                    target: 'Активний набір + якість'
                }
            ];
            
            const allCoursesHTML = `
                <div class="all-courses-section">
                    <h2>📖 Каталог курсів</h2>
                    
                    ${courses.map(course => `
                        <div class="course-card">
                            <h4>${course.name}</h4>
                            <p>${course.description}</p>
                            <div class="course-price">${course.price}</div>
                            <p><strong>Мета:</strong> ${course.target}</p>
                            <button onclick="orderCourse('${course.name}')" class="continue-button">
                                Детальна схема
                            </button>
                        </div>
                    `).join('')}
                    
                    <button onclick="showCourseQuestionnaire()" class="secondary-button">
                        📋 Персональний підбір
                    </button>
                    
                    <button onclick="showSteroidCourses()" class="back-to-menu">
                        ← Назад
                    </button>
                </div>
            `;
            
            showCustomScreen(allCoursesHTML);
        }

        function orderCourse(courseName) {
            const message = `Хочу отримати детальну схему курсу: ${courseName}`;
            window.open(`https://t.me/vladyslav_kravchukk?text=${encodeURIComponent(message)}`, '_blank');
        }

        function showHRTInfo() {
            const hrtHTML = `
                <div class="hrt-section">
                    <h2>🧬 ГЗТ - Гормонозамісна терапія</h2>
                    
                    <div class="course-card">
                        <h4>Що таке ГЗТ?</h4>
                        <p>ГЗТ-Тестостерон: повернення до чоловічої норми. З віком організм природно знижує вироблення тестостерону. Після 40–45 років багато чоловіків входять у стан гіпогонадизму.</p>
                    </div>
                    
                    <div class="course-card">
                        <h4>😰 Симптоми низького тестостерону:</h4>
                        <ul>
                            <li>Знижується лібідо</li>
                            <li>Падає енергія</li>
                            <li>Зменшується м'язова маса</li>
                            <li>Збільшується жир у зоні живота</li>
                        </ul>
                    </div>
                    
                    <div class="course-card">
                        <h4>✅ Що дає ГЗТ:</h4>
                        <ul>
                            <li>Рівень тестостерону в межах молодої норми</li>
                            <li>Ріст мотивації, настрою</li>
                            <li>Покращення сексуальної функції</li>
                            <li>Підтримка кісткової щільності</li>
                        </ul>
                    </div>
                    
                    <div class="pharma-warning">
                        <h3>⚠️ Важливо!</h3>
                        <p>ГЗТ призначається тільки лікарем після аналізів на гормони. Це не "стероїдний курс", а медична терапія!</p>
                    </div>
                    
                    <div class="upgrade-cta">
                        <p>💬 Консультація з підбору ГЗТ:</p>
                        <a href="https://t.me/vladyslav_kravchukk?text=Хочу консультацію щодо ГЗТ" target="_blank" class="upgrade-cta-btn">
                            📱 Записатися на консультацію
                        </a>
                    </div>
                    
                    <button onclick="showPharmaSection()" class="back-to-menu">
                        ← Назад до фармакології
                    </button>
                </div>
            `;
            
            showCustomScreen(hrtHTML);
        }

        function showConsultationSection() {
            const consultationHTML = `
                <div class="consultation-section">
                    <h2>👨‍⚕️ Консультація спеціаліста</h2>
                    
                    <div class="course-card">
                        <h4>Владислав Кравчук</h4>
                        <p>Спеціаліст з гормональної оптимізації</p>
                    </div>
                    
                    <div class="course-card">
                        <h4>📞 Базова консультація - 799 грн</h4>
                        <ul>
                            <li>Аналіз результатів тесту</li>
                            <li>Індивідуальні рекомендації</li>
                            <li>План обстежень</li>
                            <li>Тривалість: 45 хвилин</li>
                        </ul>
                    </div>
                    
                    <div class="course-card">
                        <h4>💎 Розширена консультація - 1299 грн</h4>
                        <ul>
                            <li>Детальний аналіз всіх систем</li>
                            <li>Персональний план на 3 місяці</li>
                            <li>Підбір добавок з схемами</li>
                            <li>Супровід протягом місяця</li>
                            <li>Тривалість: 90 хвилин</li>
                        </ul>
                    </div>
                    
                    <a href="https://t.me/vladyslav_kravchukk" target="_blank" class="continue-button">
                        📱 Написати в Telegram
                    </a>
                    
                    <button onclick="backToMenu()" class="back-to-menu">
                        🏠 Повернутися до меню
                    </button>
                </div>
            `;
            
            showCustomScreen(consultationHTML);
        }

        function showUpgradeOffer() {
            const upgradeHTML = `
                <div class="upgrade-offer">
                    <h2>🚀 Розширена версія PantelMed AI</h2>
                    
                    <div class="course-card">
                        <h4>💎 Повний пакет</h4>
                        <ul>
                            <li>Персональні стеки добавок</li>
                            <li>Детальні схеми прийому</li>
                            <li>Вилки взаємодії систем</li>
                            <li>Консультація спеціаліста</li>
                            <li>Моніторинг прогресу</li>
                        </ul>
                        <div class="course-price">1299 грн</div>
                    </div>
                    
                    <a href="https://t.me/vladyslav_kravchukk?text=Хочу замовити розширену версію PantelMed AI" 
                       target="_blank" class="continue-button">
                        💳 Замовити розширену версію
                    </a>
                    
                    <button onclick="backToMenu()" class="secondary-button">
                        ← Повернутися до безкоштовної версії
                    </button>
                </div>
            `;
            
            showCustomScreen(upgradeHTML);
        }

        function showCustomScreen(htmlContent) {
            let customScreen = document.getElementById('custom-screen');
            if (!customScreen) {
                customScreen = document.createElement('div');
                customScreen.id = 'custom-screen';
                customScreen.className = 'screen hidden';
                document.querySelector('.app').appendChild(customScreen);
            }
            
            customScreen.innerHTML = htmlContent;
            showScreen('custom-screen');
        }

        function showComingSoon(featureName) {
            const comingSoonHTML = `
                <div class="coming-soon-section">
                    <h2>🚧 ${featureName}</h2>
                    <div class="coming-soon-content">
                        <div class="construction-icon">⚙️</div>
                        <h3>Розділ в розробці</h3>
                        <p>Ми працюємо над цією функцією. Незабаром вона буде доступна!</p>
                        
                        <a href="https://t.me/vladyslav_kravchukk" target="_blank" class="continue-button">
                            🔔 Підписатися на оновлення
                        </a>
                    </div>
                    
                    <button onclick="backToMenu()" class="back-to-menu">
                        🏠 Повернутися до меню
                    </button>
                </div>
            `;
            
            showCustomScreen(comingSoonHTML);
        }

        function backToMenu() {
            showScreen('menu-screen', false);
            currentBlock = 0;
            answers = {};
            navigationHistory = [];
        }

        // Ініціалізація при завантаженні
        document.addEventListener('DOMContentLoaded', function() {
            try {
                showScreen('menu-screen', false);
                
                if (tg && tg.initDataUnsafe?.user?.first_name) {
                    const nameInput = document.getElementById('userName');
                    if (nameInput) {
                        nameInput.value = tg.initDataUnsafe.user.first_name;
                    }
                }
            } catch (error) {
                console.log('Initialization error:', error);
            }
        });

        // Валідація форми профілю
        document.addEventListener('input', function(e) {
            if (e.target.closest('#profile-screen')) {
                try {
                    const name = document.getElementById('userName')?.value || '';
                    const age = document.getElementById('userAge')?.value || '';
                    const gender = document.getElementById('userGender')?.value || '';
                    const bodyType = document.getElementById('userBodyType')?.value || '';
                    const height = document.getElementById('userHeight')?.value || '';
                    const weight = document.getElementById('userWeight')?.value || '';
                    
                    const allFilled = name && age && gender && bodyType && height && weight;
                    const continueBtn = document.querySelector('#profile-screen .continue-button');
                    if (continueBtn) {
                        continueBtn.disabled = !allFilled;
                    }
                } catch (error) {
                    console.log('Validation error:', error);
                }
            }
        });
    </script>
</body>
</html>
