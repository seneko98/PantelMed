<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PantelMed AI - Діагностика здоров'я</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #1a1a1a);
            color: var(--tg-theme-text-color, #ffffff);
            line-height: 1.4;
            font-size: 16px;
        }

        .app {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .hidden {
            display: none;
        }

        /* Кнопка назад */
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background-color: var(--tg-theme-button-color, #0088cc);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .back-button:hover {
            background-color: #0077bb;
            transform: scale(1.1);
        }

        .back-button.hidden {
            display: none;
        }

        /* Головне меню */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            background: linear-gradient(45deg, #0088cc, #0099ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--tg-theme-hint-color, #999);
            font-size: 14px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .menu-item {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            padding: 20px 15px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .menu-item:hover {
            background-color: var(--tg-theme-button-color, #0088cc);
            transform: translateY(-2px);
        }

        .menu-item.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .menu-icon {
            font-size: 32px;
            display: block;
            margin-bottom: 8px;
        }

        .menu-title {
            font-size: 13px;
            font-weight: 600;
        }

        .coming-soon {
            font-size: 10px;
            color: var(--tg-theme-hint-color, #999);
            display: block;
            margin-top: 4px;
        }

        /* Форма профілю */
        .profile-form {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--tg-theme-text-color, #ffffff);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--tg-theme-button-color, #0088cc);
            border-radius: 8px;
            background-color: var(--tg-theme-bg-color, #1a1a1a);
            color: var(--tg-theme-text-color, #ffffff);
            font-size: 16px;
        }

        /* Тест */
        .progress-bar {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            height: 8px;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            height: 100%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-bottom: 10px;
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999);
        }

        .block-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .block-title {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .block-description {
            color: var(--tg-theme-hint-color, #999);
            font-size: 14px;
        }

        .question-block {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .question-counter {
            background-color: var(--tg-theme-button-color, #0088cc);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 16px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .answer-button {
            background-color: var(--tg-theme-bg-color, #1a1a1a);
            border: 2px solid var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-text-color, #ffffff);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .answer-button:hover {
            background-color: var(--tg-theme-button-color, #0088cc);
        }

        .answer-button.selected {
            background-color: var(--tg-theme-button-color, #0088cc);
            border-color: #4caf50;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background-color: var(--tg-theme-bg-color, #1a1a1a);
            border-radius: 8px;
            cursor: pointer;
        }

        .checkbox-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        /* Кнопки */
        .continue-button {
            width: 100%;
            background: linear-gradient(45deg, #4caf50, #45a049);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .continue-button:hover {
            transform: translateY(-2px);
        }

        .continue-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .secondary-button {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            color: var(--tg-theme-text-color, #ffffff);
            border: 1px solid var(--tg-theme-button-color, #0088cc);
        }

        .back-to-menu {
            width: 100%;
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            color: var(--tg-theme-text-color, #ffffff);
            border: 1px solid var(--tg-theme-button-color, #0088cc);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
        }

        /* Результати */
        .results-container {
            margin-bottom: 30px;
        }

        .user-info {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .dominant-card {
            background: linear-gradient(135deg, #4caf50, #45a049);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }

        .dominant-emoji {
            font-size: 48px;
            display: block;
            margin-bottom: 10px;
        }

        .score-bar {
            background-color: rgba(255, 255, 255, 0.3);
            height: 8px;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            background-color: white;
            transition: width 0.3s ease;
        }

        .score-fill.good {
            background-color: #4caf50;
        }

        .score-fill.warning {
            background-color: #ff9800;
        }

        .score-fill.danger {
            background-color: #f44336;
        }

        .percentage {
            font-size: 24px;
            font-weight: bold;
        }

        .result-category {
            margin-bottom: 30px;
        }

        .result-category h4 {
            color: var(--tg-theme-button-color, #0088cc);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .result-item {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .result-name {
            font-weight: 600;
        }

        .result-percentage {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .result-percentage.good {
            background-color: #4caf50;
            color: white;
        }

        .result-percentage.warning {
            background-color: #ff9800;
            color: white;
        }

        .result-percentage.danger {
            background-color: #f44336;
            color: white;
        }

        .score-bar-small {
            background-color: var(--tg-theme-bg-color, #1a1a1a);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        /* Selling texts */
        .selling-text {
            background-color: var(--tg-theme-bg-color, #1a1a1a);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #ff6b6b;
        }

        .selling-text h5 {
            color: #ff6b6b;
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .selling-text p {
            margin: 0 0 10px 0;
            font-size: 13px;
            line-height: 1.4;
            color: var(--tg-theme-text-color, #ffffff);
        }

        .basic-practices {
            margin: 10px 0;
        }

        .basic-practices strong {
            display: block;
            margin-bottom: 5px;
            color: var(--tg-theme-text-color, #ffffff);
            font-size: 12px;
        }

        .basic-practices ul {
            margin: 0;
            padding-left: 15px;
            color: var(--tg-theme-hint-color, #999);
        }

        .basic-practices li {
            margin-bottom: 3px;
            font-size: 12px;
        }

        .upgrade-cta {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }

        .upgrade-cta p {
            color: white;
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .upgrade-cta-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Processing animation */
        .processing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .processing-overlay.visible {
            opacity: 1;
        }

        .processing-card {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            max-width: 300px;
        }

        .processing-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--tg-theme-button-color, #0088cc);
            border-top: 4px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .processing-text {
            font-size: 16px;
            margin-bottom: 15px;
            color: var(--tg-theme-text-color, #ffffff);
        }

        .processing-dots {
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .processing-dots span {
            width: 8px;
            height: 8px;
            background-color: var(--tg-theme-button-color, #0088cc);
            border-radius: 50%;
            animation: bounce 1.4s ease-in-out infinite both;
        }

        .processing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .processing-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { 
                transform: scale(0);
            } 40% { 
                transform: scale(1);
            }
        }

        /* Дієти */
        .diet-menu {
            background-color: var(--tg-theme-secondary-bg-color, #2d2d2d);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .diet-card {
            background-color: var(--tg-theme-bg-color, #1a1a1a);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #4caf50;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .diet-card:hover {
            transform: translateX(5px);
            border-left-color: #2196f3;
        }

        .diet-card h4 {
            margin: 0 0 8px 0;
            color: var(--tg-theme-text-color, #ffffff);
            font-size: 16px;
        }

        .diet-card p {
            margin: 0 0 10px 0;
            color: var(--tg-theme-hint-color, #999);
            font-size: 14px;
        }

        .diet-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .diet-tag {
            background-color: var(--tg-theme-button-color, #0088cc);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
        }

        .diet-card.featured {
            border-left-color: #ff6b6b;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(238, 90, 82, 0.05));
        }

        /* Responsive */
        @media (max-width: 480px) {
            .app {
                padding: 10px;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .answer-options {
                flex-direction: column;
            }
            
            .answer-button {
                min-width: auto;
            }

            .back-button {
                top: 10px;
                left: 10px;
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Кнопка назад -->
        <button id="backButton" class="back-button hidden" onclick="goBack()">
            ←
        </button>

        <!-- Головне меню -->
        <div id="menu-screen" class="screen">
            <div class="header">
                <h1>🧬 PantelMed AI</h1>
                <p>Розумна діагностика вашого здоров'я</p>
            </div>

            <div class="menu-grid">
                <div class="menu-item" onclick="handleMenuClick('test')">
                    <span class="menu-icon">🧬</span>
                    <span class="menu-title">Пройти тест</span>
                </div>

                <div class="menu-item" onclick="handleMenuClick('cabinet')">
                    <span class="menu-icon">👤</span>
                    <span class="menu-title">Мій кабінет</span>
                </div>

                <div class="menu-item" onclick="handleMenuClick('diet')">
                    <span class="menu-icon">🥗</span>
                    <span class="menu-title">Персональна дієта</span>
                </div>

                <div class="menu-item" onclick="handleMenuClick('pharma')">
                    <span class="menu-icon">💊💉</span>
                    <span class="menu-title">Фармакологія</span>
                </div>

                <div class="menu-item" onclick="handleMenuClick('consultation')">
                    <span class="menu-icon">👨‍⚕️</span>
                    <span class="menu-title">Консультація</span>
                </div>

                <div class="menu-item disabled">
                    <span class="menu-icon">📊</span>
                    <span class="menu-title">Аналітика</span>
                    <span class="coming-soon">Скоро</span>
                </div>
            </div>
        </div>

        <!-- Екран профілю -->
        <div id="profile-screen" class="screen hidden">
            <div class="header">
                <h2>👤 Персональні дані</h2>
                <p>Для точної діагностики потрібні ваші дані</p>
            </div>

            <div class="profile-form">
                <div class="form-group">
                    <label for="userName">Ім'я:</label>
                    <input type="text" id="userName" placeholder="Введіть ваше ім'я">
                </div>

                <div class="form-group">
                    <label for="userAge">Вік:</label>
                    <select id="userAge">
                        <option value="">Оберіть вік</option>
                        <option value="18-25">18-25 років</option>
                        <option value="26-35">26-35 років</option>
                        <option value="36-45">36-45 років</option>
                        <option value="46-55">46-55 років</option>
                        <option value="56+">56+ років</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="userGender">Стать:</label>
                    <select id="userGender">
                        <option value="">Оберіть стать</option>
                        <option value="male">Чоловік</option>
                        <option value="female">Жінка</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="userBodyType">Статура:</label>
                    <select id="userBodyType">
                        <option value="">Оберіть статуру</option>
                        <option value="thin">Худа</option>
                        <option value="normal">Нормальна</option>
                        <option value="athletic">Спортивна</option>
                        <option value="overweight">Повна</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="userHeight">Зріст (см):</label>
                    <input type="number" id="userHeight" placeholder="170" min="100" max="250">
                </div>

                <div class="form-group">
                    <label for="userWeight">Вага (кг):</label>
                    <input type="number" id="userWeight" placeholder="70" min="30" max="200">
                </div>
            </div>

            <button class="continue-button" onclick="startTestQuestions()" disabled>
                Почати тестування 🚀
            </button>
        </div>

        <!-- Екран тесту -->
        <div id="test-screen" class="screen hidden">
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <div id="progressText" class="progress-text"></div>

            <div class="block-header">
                <h2 id="blockTitle"></h2>
                <p id="blockDescription"></p>
            </div>

            <div id="questionsContainer"></div>

            <button id="nextButton" class="continue-button" onclick="nextBlockWithProcessing()" disabled>
                Далі ➡️
            </button>
        </div>

        <!-- Екран результатів -->
        <div id="results-screen" class="screen hidden">
            <div class="header">
                <h2>📊 Результати діагностики</h2>
            </div>

            <div id="userInfoResults" class="user-info"></div>
            <div id="dominantResult"></div>
            <div id="allResults" class="results-container"></div>
            <div id="upgradeSection"></div>

            <button onclick="backToMenu()" class="back-to-menu">
                🏠 Повернутися до меню
            </button>
        </div>
    </div>

    <script>
        // Telegram WebApp ініціалізація
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.expand();
            tg.ready();
        }

        // Глобальні змінні
        let currentScreen = 'menu';
        let currentBlock = 0;
        let answers = {};
        let userProfile = {};
        let userTestResults = null;
        let testCompletionDate = null;
        let navigationHistory = [];

        // Конфігурація
        const freeVersionConfig = {
            showUpgradeButtons: true,
            upgradeButtonText: '💎 Розширена версія',
            upgradeCTA: '🚀 Отримати повний доступ',
            maxRecommendations: 3
        };

        const consultationConfig = {
            specialistName: 'Владислав Кравчук',
            specialistTitle: 'Спеціаліст з функціональної медицини',
            specialistTelegram: '@vladyslav_kravchukk'
        };

        // Блоки здоров'я
        const healthBlocks = {
            serotonin: {
                name: 'Серотонін',
                emoji: '😌',
                title: '😌 СЕРОТОНІН - гормон щастя',
                description: 'рівень серотоніну впливає на настрій, сон та загальне самопочуття',
                type: 'neurotransmitter',
                questions: [
                    { id: 'ser_1', text: 'Чи часто відчуваєте пригніченість або сум без видимих причин?' },
                    { id: 'ser_2', text: 'Чи важко вам заснути або ви прокидаєтесь вночі?' },
                    { id: 'ser_3', text: 'Чи відчуваєте тривогу в повсякденних ситуаціях?' },
                    { id: 'ser_4', text: 'Чи маєте сильну тягу до солодкого або вуглеводів?' },
                    { id: 'ser_5', text: 'Чи втратили інтерес до занять, які раніше приносили задоволення?' }
                ],
                recommendations: [
                    "Триптофан 500-1000 мг перед сном",
                    "Вітамін D3 4000-6000 МО щодня (особливо взимку)",
                    "Магній глицинат 400-600 мг ввечері",
                    "Обмежити кофеїн після 14:00",
                    "Ранкове сонце 15-20 хвилин щодня"
                ]
            },
            dopamine: {
                name: 'Дофамін',
                emoji: '🎯',
                title: '🎯 ДОФАМІН - мотивація та винагорода',
                description: 'дофамін відповідає за мотивацію, енергію та відчуття задоволення',
                type: 'neurotransmitter',
                questions: [
                    { id: 'dop_1', text: 'Чи відчуваєте брак мотивації або енергії для повсякденних завдань?' },
                    { id: 'dop_2', text: 'Чи важко вам зосередитися на роботі або навчанні?' },
                    { id: 'dop_3', text: 'Чи шукаєте постійну стимуляцію (соцмережі, відео, їжа)?' },
                    { id: 'dop_4', text: 'Чи відчуваєте, що втратили здатність радіти простим речам?' },
                    { id: 'dop_5', text: 'Чи часто відкладаєте важливі справи на потім?' }
                ],
                recommendations: [
                    "L-тирозин 500-1000 мг вранці натщесерце",
                    "Фолієва кислота 800 мкг + B12 500 мкг",
                    "Обмеження швидких задоволень (TikTok, солодке)",
                    "Фізичні вправи 20-30 хв щодня",
                    "Холодний душ або контрастні процедури"
                ]
            },
            acetylcholine: {
                name: 'Ацетилхолін',
                emoji: '🧩',
                title: '🧩 АЦЕТИЛХОЛІН - пам\'ять та концентрація',
                description: 'ацетилхолін впливає на пам\'ять, навчання та когнітивні функції',
                type: 'neurotransmitter',
                questions: [
                    { id: 'ace_1', text: 'Чи маєте проблеми з пам\'яттю або забудькуватість?' },
                    { id: 'ace_2', text: 'Чи важко концентруватися на читанні або складних завданнях?' },
                    { id: 'ace_3', text: 'Чи відчуваєте "туман в голові"?' },
                    { id: 'ace_4', text: 'Чи втомлюєтесь від розумової роботи швидше, ніж раніше?' },
                    { id: 'ace_5', text: 'Чи маєте труднощі з вивченням нового матеріалу?' }
                ],
                recommendations: [
                    "Альфа-GPC 300-600 мг вранці",
                    "Холін бітартрат 500-1000 мг",
                    "Гінкго білоба 120-240 мг курсами",
                    "Омега-3 EPA/DHA 1000-2000 мг щодня",
                    "Регулярне читання і головоломки"
                ]
            },
            noradrenaline: {
                name: 'Норадреналін',
                emoji: '⚡',
                title: '⚡ НОРАДРЕНАЛІН - енергія та реакція',
                description: 'норадреналін контролює рівень енергії, увагу та стресову реакцію',
                type: 'neurotransmitter',
                questions: [
                    { id: 'nor_1', text: 'Чи відчуваєте хронічну втому навіть після відпочинку?' },
                    { id: 'nor_2', text: 'Чи важко вам "включитися" в роботу або активність?' },
                    { id: 'nor_3', text: 'Чи погано реагуєте на стрес або непередбачені ситуації?' },
                    { id: 'nor_4', text: 'Чи низький у вас рівень уваги та концентрації?' },
                    { id: 'nor_5', text: 'Чи потребуєте кофеїну або стимуляторів для нормального функціонування?' }
                ],
                recommendations: [
                    "L-тирозин 1000-1500 мг вранці",
                    "Родіола рожева 300-600 мг курсами",
                    "Вітаміни групи B (комплекс)",
                    "Регулярний сон 7-9 годин",
                    "Помірні кардіо навантаження"
                ]
            },
            gaba: {
                name: 'ГАМК',
                emoji: '🧘‍♂️',
                title: '🧘‍♂️ ГАМК - спокій та розслаблення',
                description: 'ГАМК відповідає за розслаблення, зниження тривоги та якісний сон',
                type: 'neurotransmitter',
                questions: [
                    { id: 'gab_1', text: 'Чи важко вам розслабитися навіть у вільний час?' },
                    { id: 'gab_2', text: 'Чи відчуваєте підвищену тривожність або нервозність?' },
                    { id: 'gab_3', text: 'Чи маєте м\'язову напругу або скутість?' },
                    { id: 'gab_4', text: 'Чи чутливі до громких звуків або яскравого світла?' },
                    { id: 'gab_5', text: 'Чи швидко втомлюєтесь від соціального спілкування?' }
                ],
                recommendations: [
                    "Магній глицинат 400-800 мг ввечері",
                    "Таурин 1000-2000 мг",
                    "Теанін 200-400 мг для релаксації",
                    "Глубоке дихання 4-7-8",
                    "Йога або медитація 10-20 хв"
                ]
            },
            testosterone: {
                name: 'Тестостерон',
                emoji: '💪',
                title: '💪 ТЕСТОСТЕРОН - король гормонів',
                description: 'тестостерон впливає на енергію, лібідо, м\'язову масу та настрій',
                type: 'hormone',
                genderSpecific: 'male',
                questions: [
                    { id: 'tes_1', text: 'Чи знизилося ваше сексуальне бажання?' },
                    { id: 'tes_2', text: 'Чи важко набираєте м\'язову масу навіть при тренуваннях?' },
                    { id: 'tes_3', text: 'Чи відчуваєте хронічну втому або низьку енергію?' },
                    { id: 'tes_4', text: 'Чи помітили збільшення жиру в області живота?' },
                    { id: 'tes_5', text: 'Чи знизилася ваша впевненість в собі або мотивація?' }
                ],
                recommendations: [
                    "Цинк 15-30 мг з їжею",
                    "Магній 400-600 мг",
                    "Вітамін D3 5000-10000 МО",
                    "Силові тренування 3-4 рази на тиждень",
                    "Якісний сон 7-9 годин"
                ]
            },
            estradiol_male: {
                name: 'Естрадіол (чол.)',
                emoji: '⚖️',
                title: '⚖️ ЕСТРАДІОЛ (чоловіки) - баланс гормонів',
                description: 'естрадіол у чоловіків має бути в балансі з тестостероном',
                type: 'hormone',
                genderSpecific: 'male',
                questions: [
                    { id: 'esm_1', text: 'Чи помічаєте гінекомастію (збільшення грудей)?' },
                    { id: 'esm_2', text: 'Чи маєте емоційну нестабільність або частіші сльози?' },
                    { id: 'esm_3', text: 'Чи знизилася якість ерекції?' },
                    { id: 'esm_4', text: 'Чи накопичуєте жир у нижній частині тіла?' },
                    { id: 'esm_5', text: 'Чи відчуваєте зниження агресивності та конкурентності?' }
                ],
                recommendations: [
                    "DIM (дііндолілметан) 200-400 мг",
                    "Цинк для ароматази",
                    "Зниження % жиру (дієта + тренування)",
                    "Обмеження алкоголю",
                    "Уникання пластикових контейнерів"
                ]
            },
            estradiol_female: {
                name: 'Естрадіол (жін.)',
                emoji: '🌸',
                title: '🌸 ЕСТРАДІОЛ (жінки) - жіночність',
                description: 'естрадіол контролює менструальний цикл та жіноче здоров\'я',
                type: 'hormone',
                genderSpecific: 'female',
                questions: [
                    { id: 'esf_1', text: 'Чи маєте нерегулярний менструальний цикл?' },
                    { id: 'esf_2', text: 'Чи відчуваєте сухість шкіри або волосся?' },
                    { id: 'esf_3', text: 'Чи знизилося сексуальне бажання?' },
                    { id: 'esf_4', text: 'Чи маєте приливи жару або пітливість?' },
                    { id: 'esf_5', text: 'Чи відчуваєте болючість в грудях перед менструацією?' }
                ],
                recommendations: [
                    "Омега-3 1000-2000 мг",
                    "Магній 300-400 мг",
                    "Вітамін E 400 МО",
                    "Регулярний цикл сну",
                    "Помірні фізичні навантаження"
                ]
            },
            prolactin: {
                name: 'Пролактин',
                emoji: '🍼',
                title: '🍼 ПРОЛАКТИН - материнський гормон',
                description: 'підвищений пролактин знижує лібідо та може викликати проблеми',
                type: 'hormone',
                questions: [
                    { id: 'prol_1', text: 'Чи знизилося сексуальне бажання?' },
                    { id: 'prol_2', text: 'Чи маєте проблеми з ерекцією (для чоловіків) або сухість (для жінок)?' },
                    { id: 'prol_3', text: 'Чи відчуваєте втому після оргазму довше звичайного?' },
                    { id: 'prol_4', text: 'Чи помічаєте виділення з сосків (не під час вагітності/лактації)?', genderSpecific: 'female' },
                    { id: 'prol_5', text: 'Чи маєте емоційну нестабільність або депресивні епізоди?' }
                ],
                recommendations: [
                    "Вітекс священний (Vitex) 400-800 мг",
                    "Цинк 15-30 мг",
                    "Зниження стресу (медитація)",
                    "Уникання стимуляції сосків",
                    "Обмеження пролактогенних препаратів"
                ]
            },
            female_hormones: {
                name: 'Жіночі гормони',
                emoji: '👩',
                title: '👩 ЖІНОЧІ ГОРМОНИ - циклічність',
                description: 'гормональний баланс впливає на цикл, настрій та загальне здоров\'я',
                type: 'hormone',
                genderSpecific: 'female',
                questions: [
                    { 
                        id: 'fem_1', 
                        text: 'Який у вас зазвичай менструальний цикл?',
                        type: 'cycle',
                        options: [
                            { text: '21-35 днів (регулярний)', score: 2 },
                            { text: 'Нерегулярний, але передбачуваний', score: 1 },
                            { text: 'Дуже нерегулярний або відсутній', score: 0 }
                        ]
                    },
                    { 
                        id: 'fem_2', 
                        text: 'Як інтенсивно проходить ваша менструація?',
                        type: 'flow',
                        options: [
                            { text: 'Помірно (3-7 днів)', score: 2 },
                            { text: 'Дуже рясно або довго (7+ днів)', score: 1 },
                            { text: 'Дуже скудно (1-2 дні)', score: 0 }
                        ]
                    },
                    { id: 'fem_3', text: 'Чи маєте сильний ПМС (дратівливість, здуття, біль)?' },
                    { id: 'fem_4', text: 'Чи відчуваєте різкі зміни настрою протягом циклу?' },
                    { id: 'fem_5', text: 'Чи маєте проблеми зі шкірою (акне) перед менструацією?' }
                ],
                recommendations: [
                    "Магній 300-600 мг (особливо перед менструацією)",
                    "Вітамін B6 50-100 мг для ПМС",
                    "Омега-3 для зменшення запалення",
                    "Регулярний сон та режим",
                    "Відстеження циклу (додатки)"
                ]
            },
            digestive_system: {
                name: 'Шлунково-кишковий тракт',
                emoji: '🍽️',
                title: '🍽️ ШКТ - "другий мозок"',
                description: 'шлунково-кишковий тракт виробляє 80% серотоніну',
                type: 'system',
                questions: [
                    { id: 'dig_1', text: 'Чи маєте проблеми з травленням (здуття, гази, дискомфорт)?' },
                    { id: 'dig_2', text: 'Чи нерегулярний стілець (запори або діарея)?' },
                    { id: 'dig_3', text: 'Чи відчуваєте печію або кислотність?' },
                    { id: 'dig_4', text: 'Чи маєте пищевую непереносимість або алергії?' },
                    { id: 'dig_5', text: 'Чи часто приймали антибіотики останнім часом?' }
                ],
                recommendations: [
                    "Пробіотики 10-50 млрд КУО",
                    "Ферменти з їжею",
                    "L-глутамін для відновлення слизової",
                    "Виключення глютену на 2-4 тижні",
                    "Їжа по режиму (без перекусів)"
                ]
            },
            musculoskeletal_system: {
                name: 'Опорно-руховий апарат',
                emoji: '🦴',
                title: '🦴 ОПОРНО-РУХОВИЙ АПАРАТ - основа руху',
                description: 'здоров\'я суглобів, м\'язів та кісток впливає на якість життя',
                type: 'system',
                questions: [
                    { id: 'mus_1', text: 'Чи маєте болі в суглобах або спині?' },
                    { id: 'mus_2', text: 'Чи відчуваєте ранкову скутість?' },
                    { id: 'mus_3', text: 'Чи знижена гнучкість або рухливість?' },
                    { id: 'mus_4', text: 'Чи маєте хрони або клацання в суглобах?' },
                    { id: 'mus_5', text: 'Чи швидко втомлюються м\'язи при навантаженнях?' }
                ],
                recommendations: [
                    "Глюкозамін + хондроїтин 1500/1200 мг",
                    "MSM (метилсульфонілметан) 1000-3000 мг",
                    "Колаген II типу 40 мг",
                    "Регулярна розтяжка щодня",
                    "Помірні силові навантаження"
                ]
            },
            skin_system: {
                name: 'Система шкіри',
                emoji: '✨',
                title: '✨ ШКІРА - дзеркало здоров\'я',
                description: 'стан шкіри відображає внутрішні процеси організму',
                type: 'system',
                questions: [
                    { id: 'skin_1', text: 'Чи маєте акне або запальні елементи?' },
                    { id: 'skin_2', text: 'Чи суха або лущиться шкіра?' },
                    { id: 'skin_3', text: 'Чи повільно заживають подряпини або рани?' },
                    { id: 'skin_4', text: 'Чи маєте екзему, дерматит або алергічні реакції?' },
                    { id: 'skin_5', text: 'Чи передчасно старіє шкіра (зморшки, втрата еластичності)?' }
                ],
                recommendations: [
                    "Цинк 15-30 мг для загоєння",
                    "Омега-3 для зниження запалення",
                    "Вітамін C 1000 мг для колагену",
                    "Пробіотики (зв\'язок кишечник-шкіра)",
                    "Захист від сонця SPF 30+"
                ]
            },
            liver: {
                name: 'Печінка',
                emoji: '🫀',
                title: '🫀 ПЕЧІНКА - фільтр організму',
                description: 'печінка відповідає за детоксикацію та метаболізм гормонів',
                type: 'system',
                questions: [
                    { id: 'liv_1', text: 'Чи відчуваєте тяжкість в правому підребер\'ї?' },
                    { id: 'liv_2', text: 'Чи жовтуватий колір шкіри або білків очей?' },
                    { id: 'liv_3', text: 'Чи швидко п\'яніти від невеликої кількості алкоголю?' },
                    { id: 'liv_4', text: 'Чи є неприємний запах з рота вранці?' },
                    { id: 'liv_5', text: 'Чи часто відчуваєте втому після їжі?' }
                ],
                recommendations: [
                    "Розторопша (силімарин) 150-300 мг",
                    "NAC (N-ацетилцистеїн) 600-1200 мг",
                    "Відмова від алкоголю на 4-8 тижнів",
                    "Лимонна вода вранці натщесерце",
                    "Зменшення жирної їжі"
                ]
            },
            cortisol: {
                name: 'Кортизол',
                emoji: '😰',
                title: '😰 КОРТИЗОЛ - гормон стресу',
                description: 'кортизол контролює стресову реакцію та енергетичний обмін',
                type: 'hormone',
                questions: [
                    { id: 'cor_1', text: 'Чи важко прокидаєтесь вранці?' },
                    { id: 'cor_2', text: 'Чи відчуваєте спад енергії вдень (особливо після обіду)?' },
                    { id: 'cor_3', text: 'Чи накопичуєте жир переважно в області живота?' },
                    { id: 'cor_4', text: 'Чи важко заснути через "прокручування" думок?' },
                    { id: 'cor_5', text: 'Чи маєте тягу до солодкого при стресі?' }
                ],
                recommendations: [
                    "Ашваганда 300-600 мг курсами",
                    "Фосфатидилсерин 100-200 мг",
                    "Магній для розслаблення",
                    "Техніки дихання та медитація",
                    "Регулярний режим сну"
                ]
            },
            sleep: {
                name: 'Сон',
                emoji: '😴',
                title: '😴 СОН - відновлення організму',
                description: 'якісний сон критично важливий для здоров\'я та гормонів',
                type: 'lifestyle',
                questions: [
                    { id: 'sle_1', text: 'Чи важко заснути (більше 30 хвилин)?' },
                    { id: 'sle_2', text: 'Чи часто прокидаєтесь вночі?' },
                    { id: 'sle_3', text: 'Чи відчуваєте себе не відпочившим вранці?' },
                    { id: 'sle_4', text: 'Чи спите менше 7 годин на ніч?' },
                    { id: 'sle_5', text: 'Чи хропите або маєте зупинки дихання?' }
                ],
                recommendations: [
                    "Мелатонін 0.5-3 мг за 30 хв до сну",
                    "Магній глицинат 400-600 мг ввечері",
                    "Виключення екранів за 1-2 години до сну",
                    "Прохолодна кімната (18-20°C)",
                    "Регулярний час сну та підйому"
                ]
            },
            thyroid: {
                name: 'Щитовидна залоза',
                emoji: '🦋',
                title: '🦋 ЩИТОВИДНА ЗАЛОЗА - метаболічний двигун',
                description: 'щитовидна залоза контролює метаболізм та енергетичний обмін',
                type: 'hormone',
                questions: [
                    { id: 'thy_1', text: 'Чи відчуваєте хронічну втому навіть після відпочинку?' },
                    { id: 'thy_2', text: 'Чи важко схуднути навіть при дієті?' },
                    { id: 'thy_3', text: 'Чи часто мерзнете або маєте холодні руки/ноги?' },
                    { id: 'thy_4', text: 'Чи випадає волосся або стало тонким?' },
                    { id: 'thy_5', text: 'Чи маєте закрепи або повільне травлення?' }
                ],
                recommendations: [
                    "Йод 150-300 мкг (обережно!)",
                    "Селен 200 мкг",
                    "Цинк 15-30 мг",
                    "Тирозин 500-1000 мг вранці",
                    "Виключення глютену (при аутоімунних процесах)"
                ]
            },
            cardiovascular: {
                name: 'Серцево-судинна система',
                emoji: '❤️',
                title: '❤️ СЕРЦЕВО-СУДИННА СИСТЕМА - мотор життя',
                description: 'здоров\'я серця та судин - основа довголіття',
                type: 'system',
                questions: [
                    { id: 'card_1', text: 'Чи маєте підвищений артеріальний тиск?' },
                    { id: 'card_2', text: 'Чи відчуваєте серцебиття або перебої в роботі серця?' },
                    { id: 'card_3', text: 'Чи задишка при невеликих фізичних навантаженнях?' },
                    { id: 'card_4', text: 'Чи набряки ніг ввечері?' },
                    { id: 'card_5', text: 'Чи болі або дискомфорт в грудній клітці?' }
                ],
                recommendations: [
                    "Омега-3 EPA/DHA 1000-2000 мг",
                    "CoQ10 100-200 мг",
                    "Магній для серцевого ритму",
                    "Кардіо навантаження 150 хв/тиждень",
                    "Контроль солі (до 5г/день)"
                ]
            },
            kidneys: {
                name: 'Нирки',
                emoji: '🚰',
                title: '🚰 НИРКИ - фільтр організму',
                description: 'нирки відповідають за виведення токсинів та водно-сольовий баланс',
                type: 'system',
                questions: [
                    { id: 'kid_1', text: 'Чи часто встаєте в туалет вночі (2+ рази)?' },
                    { id: 'kid_2', text: 'Чи маєте набряки, особливо вранці?' },
                    { id: 'kid_3', text: 'Чи змінився колір або запах сечі?' },
                    { id: 'kid_4', text: 'Чи біль або дискомфорт в попереку?' },
                    { id: 'kid_5', text: 'Чи підвищений тиск без інших причин?' }
                ],
                recommendations: [
                    "Достатнє споживання води (30-35 мл/кг)",
                    "Журавлина (екстракт) 500-1000 мг",
                    "Обмеження солі та обробленої їжі",
                    "Контроль цукру в крові",
                    "Регулярні аналізи сечі"
                ]
            },
            insulin: {
                name: 'Інсулін та вуглеводний обмін',
                emoji: '📊',
                title: '📊 ІНСУЛІН - контроль цукру',
                description: 'інсулінова чутливість впливає на енергію, вагу та здоров\'я',
                type: 'metabolic',
                questions: [
                    { id: 'ins_1', text: 'Чи сильна тяга до солодкого, особливо після їжі?' },
                    { id: 'ins_2', text: 'Чи втома через 1-2 години після прийому їжі?' },
                    { id: 'ins_3', text: 'Чи важко схуднути, особливо в області живота?' },
                    { id: 'ins_4', text: 'Чи частий голод навіть після ситної їжі?' },
                    { id: 'ins_5', text: 'Чи є темні плями на шкірі (шия, підпахви)?' }
                ],
                recommendations: [
                    "Хром піколінат 200-400 мкг",
                    "Берберин 500 мг 2-3 рази на день",
                    "Альфа-ліпоєва кислота 300-600 мг",
                    "Інтервальне голодування 16:8",
                    "Зниження простих вуглеводів"
                ]
            },
            breathing: {
                name: 'Хропіння, носове дихання, апное',
                emoji: '😤',
                title: '😤 ДИХАННЯ - основа життя',
                description: 'якість дихання впливає на сон, енергію та загальне здоров\'я',
                type: 'medical',
                questions: [
                    { id: 'bre_1', text: 'Чи хропите під час сну?' },
                    { id: 'bre_2', text: 'Чи важко дихати носом (закладеність)?' },
                    { id: 'bre_3', text: 'Чи буває сухість у роті вранці?' },
                    { id: 'bre_4', text: 'Чи відчуваєте втому навіть після тривалого сну?' },
                    { id: 'bre_5', text: 'Чи помічали зупинки дихання під час сну?' }
                ],
                recommendations: [
                    "Дихальні вправи (4-7-8)",
                    "Зволожувач повітря в спальні",
                    "Очищення носових ходів (фізрозчин)",
                    "Сон на боку замість спини",
                    "Консультація отоларинголога"
                ]
            },
            activity: {
                name: 'Рівень щоденної активності',
                emoji: '🚶‍♂️',
                title: '🚶‍♂️ АКТИВНІСТЬ - рух це життя',
                description: 'фізична активність впливає на всі системи організму',
                type: 'lifestyle',
                questions: [
                    { 
                        id: 'act_1', 
                        text: 'Скільки ви зазвичай проходите кроків на день?',
                        type: 'multiple_choice',
                        options: [
                            { text: 'Менше 1 000 кроків (сидячий спосіб життя)', score: 0 },
                            { text: 'Від 1 000 до 5 000 кроків (легка активність)', score: 1 },
                            { text: 'Від 5 000 до 10 000 і більше (активний спосіб життя)', score: 2 }
                        ]
                    },
                    { 
                        id: 'act_2', 
                        text: 'Скільки годин на день ви проводите в сидячому положенні?',
                        type: 'multiple_choice',
                        options: [
                            { text: '2-4 години (норма)', score: 2 },
                            { text: '5-7 годин (середньо)', score: 1 },
                            { text: '8+ годин (критично)', score: 0 }
                        ]
                    },
                    { id: 'act_3', text: 'Чи займаєтесь ви регулярними фізичними вправами?' },
                    { id: 'act_4', text: 'Чи відчуваєте ви задишку при підйомі на 2-3 поверх?' },
                    { id: 'act_5', text: 'Чи користуєтесь ви ліфтом замість сходів?' }
                ],
                recommendations: [
                    "Мінімум 8 000 кроків/день для оптимального здоров'я",
                    "Перерви кожні 45 хвилин при сидячій роботі",
                    "Силові тренування 2–3 рази на тиждень",
                    "Активна ходьба/легкий біг — 3–4 рази на тиждень",
                    "При тривалому сидінні: ризик простатиту, геморою, ↓тестостерон"
                ]
            },
            nutrition: {
                name: 'Базове харчування',
                emoji: '🍎',
                title: '🍎 ХАРЧУВАННЯ - основа здоров\'я',
                description: 'якість харчування визначає енергію, настрій та довголіття',
                type: 'lifestyle',
                questions: [
                    { 
                        id: 'nut_1', 
                        text: 'Як часто ви споживаєте білок (м\'ясо, яйця, молочка, риба)?',
                        type: 'multiple_choice',
                        options: [
                        { text: 'Декілька разів на день (м\'ясо, яйця, молочка, риба)', score: 2 },
                            { text: '1 раз на день', score: 1 },
                            { text: 'Рідко (менше 4 разів на тиждень)', score: 0 }
                        ]
                    },
                    { 
                        id: 'nut_2', 
                        text: 'Як часто ви споживаєте фастфуд або напівфабрикати?',
                        type: 'multiple_choice',
                        options: [
                            { text: '1-2 рази на тиждень або рідше', score: 2 },
                            { text: '3–5 разів', score: 1 },
                            { text: '6+ разів', score: 0 }
                        ]
                    },
                    { 
                        id: 'nut_3', 
                        text: 'Як часто ви їсте солодке / доданий цукор (печиво, цукерки, десерти)?',
                        type: 'multiple_choice',
                        options: [
                            { text: 'Не їм', score: 2 },
                            { text: 'Інколи', score: 1 },
                            { text: 'Щодня / кілька разів на день', score: 0 }
                        ]
                    },
                    { 
                        id: 'nut_4', 
                        text: 'Чи додаєте цукор у каву/чай і скільки ложок?',
                        type: 'multiple_choice',
                        options: [
                            { text: 'Не додаю / використовую замінники', score: 2 },
                            { text: 'До 1 ложки', score: 1 },
                            { text: '2+ ложки', score: 0 }
                        ]
                    },
                    { 
                        id: 'nut_5', 
                        text: 'Скільки кави ви п\'єте на день?',
                        type: 'multiple_choice',
                        options: [
                            { text: '0–1 чашка', score: 2 },
                            { text: '2–3 чашки', score: 1 },
                            { text: '4+ чашки', score: 0 }
                        ]
                    },
                    { 
                        id: 'nut_6', 
                        text: 'Чи їсте ви смажені страви (олія/фритюр)?',
                        type: 'multiple_choice',
                        options: [
                            { text: 'Рідко', score: 2 },
                            { text: '1–3 рази на тиждень', score: 1 },
                            { text: 'Часто / щодня', score: 0 }
                        ]
                    },
                    { 
                        id: 'nut_7', 
                        text: 'Скільки чистої води ви п\'єте щодня (не рахуючи чаю/кави)?',
                        type: 'multiple_choice',
                        options: [
                            { text: '1,5–2 л і більше', score: 2 },
                            { text: '~1 л', score: 1 },
                            { text: 'Менше 1 л', score: 0 }
                        ]
                    }
                ],
                recommendations: [
                    "Білок: 1,2–2 г на 1 кг маси тіла",
                    "Цукрозамінники: стевія, еритрит, але краще перейти на мед",
                    "Для покращення інсулінової чутливості: берберин, хром, альфа-ліпоєва кислота",
                    "Сніданок: білок + корисні жири → стабілізація інсуліну зранку",
                    "Питна вода: мінімум 30 мл / кг маси тіла"
                ]
            },
            chronic: {
                name: 'Хронічні хвороби',
                emoji: '🏥',
                title: '🏥 ХРОНІЧНІ ЗАХВОРЮВАННЯ - вплив на загальне здоров\'я',
                description: 'наявність хронічних захворювань впливає на всі системи організму',
                type: 'medical',
                questions: [
                    { 
                        id: 'chr_1', 
                        text: 'Чи є у вас діагностовані хронічні захворювання?',
                        type: 'multiple_select',
                        options: [
                            { text: 'Простатит / проблеми з простатою', value: 'prostatitis' },
                            { text: 'Хронічний тонзиліт / часті ангіни', value: 'tonsillitis' },
                            { text: 'Хронічні утруднення дихання / астма', value: 'breathing' },
                            { text: 'Грижі, протрузії хребта', value: 'spine' },
                            { text: 'Артрити, артрози суглобів', value: 'joints' },
                            { text: 'Печінка (гепатоз, гепатит, синдром Жільбера)', value: 'liver' },
                            { text: 'Нирки / сечовидільна система (цистит, пієлонефрит)', value: 'kidneys' },
                            { text: 'Серцево-судинна система (гіпертонія, аритмія, ішемія)', value: 'cardio' },
                            { text: 'Аутоімунні захворювання (тиреоїдит, псоріаз)', value: 'autoimmune' },
                            { text: 'ШКТ (хронічний гастрит, коліт, Хелікобактер)', value: 'git' },
                            { text: 'Немає хронічних захворювань', value: 'none' }
                        ]
                    }
                ],
                recommendations: [
                    "При простатиті: тиква насіння, цинк, ліків масаж простати, аналізи ПСА",
                    "При тонзиліті: імуномодулятори курсами, санація вогнищ інфекції",
                    "При проблемах дихання: консультація пульмонолога, спірометрія",
                    "При грижах: ЛФК для хребта, плавання, уникання важких навантажень",
                    "При артрозах: хондропротектори, помірна активність, контроль ваги"
                ]
            }
        };

        // Додаткові питання для кожного блоку
        const extraQuestions = {
            serotonin: [
                { id: 'ser_extra_1', text: 'Мені важко зосередитися, мої думки часто "розбігаються".' },
                { id: 'ser_extra_2', text: 'Втрачаю інтерес до справ, які раніше приносили задоволення.' },
                { id: 'ser_extra_3', text: 'Мене дратують дрібниці, навіть без серйозної причини.' },
                { id: 'ser_extra_4', text: 'Моя вага сильно змінюється (апетит змінюється залежно від настрою).' },
                { id: 'ser_extra_5', text: 'Я часто відчуваю безнадію або втрату сенсу.' }
            ],
            dopamine: [
                { id: 'dop_extra_1', text: 'Я часто втомлений, навіть після відпочинку.' },
                { id: 'dop_extra_2', text: 'Мені складно вийти з дому або зрушити з місця.' },
                { id: 'dop_extra_3', text: 'Я став байдужим до винагороди.' },
                { id: 'dop_extra_4', text: 'Мене рідко радує досягнення цілей.' },
                { id: 'dop_extra_5', text: 'Часто прокрастиную, хоча знаю, що треба діяти.' }
            ],
            acetylcholine: [
                { id: 'ace_extra_1', text: 'Я відчуваю туман в голові або забудькуватість.' },
                { id: 'ace_extra_2', text: 'Мені складно концентруватися навіть на простих речах.' },
                { id: 'ace_extra_3', text: 'Я швидко виснажуюсь під час розумової роботи.' },
                { id: 'ace_extra_4', text: 'Часто плутаюсь у словах або втрачаю хід думок.' },
                { id: 'ace_extra_5', text: 'Маю труднощі з навчанням або запам\'ятовуванням нового.' }
            ],
            noradrenaline: [
                { id: 'nor_extra_1', text: 'Я відчуваю себе нервовим, але без енергії виплеснути це почуття.' },
                { id: 'nor_extra_2', text: 'У мене часто несподівано бувають прискорене серцебиття або відчуття "метеликів" у животі.' },
                { id: 'nor_extra_3', text: 'Я зауважую, що роблю багато помилок в простих завданнях через неуважність.' },
                { id: 'nor_extra_4', text: 'У стресових ситуаціях я часто "зависаю" і не можу швидко реагувати.' },
                { id: 'nor_extra_5', text: 'Мені важко відчувати гострі емоції (радість, збудження, інтерес).' }
            ],
            gaba: [
                { id: 'gab_extra_1', text: 'Я відчуваю ком у горлі або труднощі з ковтанням (особливо під час стресу).' },
                { id: 'gab_extra_2', text: 'Я гіперчутливий до гучних звуків, яскравого світла або сильних запахів.' },
                { id: 'gab_extra_3', text: 'Мої м\'язи часто болять без видимої причини, особливо шия і плечі.' },
                { id: 'gab_extra_4', text: 'Я легко лякаюсь від несподіваних звуків або рухів.' },
                { id: 'gab_extra_5', text: 'Мені важко їздити в транспорті через відчуття тривоги.' }
            ],
            testosterone: [
                { id: 'tes_extra_1', text: 'Я помічаю збільшення жиру в області грудей та живота.' },
                { id: 'tes_extra_2', text: 'У мене з\'явився підвищений рівень депресії та/або дратівливості.' },
                { id: 'tes_extra_3', text: 'Я помічаю погіршення в ясності мислення та прийнятті рішень.' },
                { id: 'tes_extra_4', text: 'Я відчуваю суглобовий та м\'язовий біль без очевидних причин.' },
                { id: 'tes_extra_5', text: 'У мене знижена впевненість у собі та соціальна активність.' }
            ],
            estradiol_male: [
                { id: 'esm_extra_1', text: 'Я помічаю надмірне потовиділення (особливо вночі).' },
                { id: 'esm_extra_2', text: 'У мене з\'явилися проблеми з концентрацією уваги.' },
                { id: 'esm_extra_3', text: 'Я спостерігаю підвищену чутливість до запахів, смаків або дотиків.' },
                { id: 'esm_extra_4', text: 'Я відчуваю проблеми із сечовипусканням або сексуальною функцією.' },
                { id: 'esm_extra_5', text: 'Я став більш емоційно реагувати на фільми або новини.' }
            ],
            estradiol_female: [
                { id: 'esf_extra_1', text: 'Я помічаю збільшення жирової тканини в нижній частині тіла.' },
                { id: 'esf_extra_2', text: 'У мене бувають припливи жару або холоду без видимих причин.' },
                { id: 'esf_extra_3', text: 'Я страждаю від головних болей, особливо перед менструацією.' },
                { id: 'esf_extra_4', text: 'Я помічаю зміни в стані волосся та нігтів (ламкість, тьмяність).' },
                { id: 'esf_extra_5', text: 'Я відчуваю зміни в сексуальному бажанні протягом циклу.' }
            ],
            prolactin: [
                { id: 'prol_extra_1', text: 'Часто буваю надмірно емоційним / плаксивим' },
                { id: 'prol_extra_2', text: 'Мене засмучують навіть незначні події або коментарі' },
                { id: 'prol_extra_3', text: 'Після оргазму відчуваю "порожнечу" або відключеність' },
                { id: 'prol_extra_4', text: 'Маю знижену ініціативність, як ніби "немає сил хотіти"' },
                { id: 'prol_extra_5', text: 'Немає мотивації до флірту, сексуального спілкування' }
            ],
            female_hormones: [
                { id: 'fem_extra_1', text: 'Чи спостерігаєш набряки перед менструацією (обличчя, руки, ноги)?' },
                { id: 'fem_extra_2', text: 'Чи погіршується стан шкіри перед або під час менструації (прищі, жирність, запалення)?' },
                { id: 'fem_extra_3', text: 'Чи виникають проблеми зі сном або сильна втома перед місячними?' },
                { id: 'fem_extra_4', text: 'Чи впливає цикл на твою працездатність та енергійність?' },
                { id: 'fem_extra_5', text: 'Чи відчуваєш сильні емоційні коливання в певні дні циклу?' }
            ],
            digestive_system: [
                { 
                    id: 'dig_extra_1', 
                    text: 'Чи вживаєш ти овочі, фрукти та інші джерела клітковини кожного дня?',
                    type: 'multiple_choice',
                    options: [
                        { text: 'Так, щодня', score: 2 },
                        { text: 'Декілька разів на тиждень', score: 1 },
                        { text: 'Ні', score: 0 }
                    ]
                },
                { id: 'dig_extra_2', text: 'Чи маєш біль або печіння у верхній частині живота після їжі?' },
                { id: 'dig_extra_3', text: 'Чи помічав(ла) ти симптоми кандидозу (постійне здуття, грибок, сильна тяга до солодкого чи хлібобулочних виробів)?' },
                { id: 'dig_extra_4', text: 'Чи часто приймав(ла) ти антибіотики протягом останнього року?' },
                { id: 'dig_extra_5', text: 'Чи маєш часту печію або відчуття печіння в шлунку?' }
            ],
            musculoskeletal_system: [
                { id: 'mus_extra_1', text: 'Чи відчуваєш тріск або "клацання" в суглобах під час руху?' },
                { id: 'mus_extra_2', text: 'Чи скутість вранці триває більше 15 хвилин?' },
                { id: 'mus_extra_3', text: 'Чи є зниження гнучкості або рухливості в суглобах?' },
                { id: 'mus_extra_4', text: 'Чи маєш хронічні болі після старих травм?' },
                { id: 'mus_extra_5', text: 'Чи важко піднятися по сходах без втоми в ногах?' }
            ],
            skin_system: [
                { id: 'skin_extra_1', text: 'Чи помічаєш зв\'язок між висипаннями та стресом?' },
                { id: 'skin_extra_2', text: 'Чи маєш проблеми зі шкірою після вживання певних продуктів?' },
                { id: 'skin_extra_3', text: 'Чи з\'являються висипання після інтенсивних тренувань?' },
                { id: 'skin_extra_4', text: 'Чи є сухість або лущення шкіри?' },
                { id: 'skin_extra_5', text: 'Чи помічав(ла) зміни в текстурі або кольорі шкіри?' }
            ],
            liver: [
                { id: 'liv_extra_1', text: 'Відчуваю неприємний запах з рота' },
                { id: 'liv_extra_2', text: 'Тест на алкоголь пройдений, але відчуваю "похмілля"' },
                { id: 'liv_extra_3', text: 'Часто маю здутий живіт після прийому їжі' },
                { id: 'liv_extra_4', text: 'Кал світлішого кольору, ніж звичайно' },
                { id: 'liv_extra_5', text: 'Жовтуватий відтінок шкіри або білка очей' }
            ],
            cortisol: [
                { id: 'cor_extra_1', text: 'Відчуваю сильну втому вдень, але друге дихання ввечері' },
                { id: 'cor_extra_2', text: 'Маю тягу до солодкого або солоного під час стресу' },
                { id: 'cor_extra_3', text: 'Відчуваю різкі перепади енергії протягом дня' },
                { id: 'cor_extra_4', text: 'Важко розслабитися навіть у спокійній обстановці' },
                { id: 'cor_extra_5', text: 'Накопичую жир переважно в області живота' }
            ],
            sleep: [
                { id: 'sle_extra_1', text: 'Просинаюсь у той самий час вночі (наприклад, між 2 і 4 годинами)' },
                { id: 'sle_extra_2', text: 'Відчуваю сонливість вдень, але бадьорість ввечері' },
                { id: 'sle_extra_3', text: 'Маю неспокійні ноги або судоми під час сну' },
                { id: 'sle_extra_4', text: 'Хропу або відчуваю затримки дихання під час сну' },
                { id: 'sle_extra_5', text: 'Часто бачу яскраві або тривожні сни' }
            ],
            thyroid: [
                { id: 'thy_extra_1', text: 'Чи маєш проблеми зі сном або занадто активний сон?' },
                { id: 'thy_extra_2', text: 'Чи є відчуття жару або надмірної пітливості без фізичних причин?' },
                { id: 'thy_extra_3', text: 'Чи спостерігаєш набряки обличчя вранці?' },
                { id: 'thy_extra_4', text: 'Чи буває тремор рук?' },
                { id: 'thy_extra_5', text: 'Чи відчуваєш підвищену чутливість до холоду або спеки?' }
            ],
            cardiovascular: [
                { id: 'card_extra_1', text: 'Чи буває запаморочення або слабкість при зміні положення тіла (різко встав, різкий рух)?' },
                { id: 'card_extra_2', text: 'Чи маєш часті головні болі або відчуття пульсації в скронях?' },
                { id: 'card_extra_3', text: 'Чи є у тебе періодичні оніміння рук/ніг або зниження чутливості?' },
                { id: 'card_extra_4', text: 'Чи легко в тебе з\'являються синці без очевидної причини?' },
                { id: 'card_extra_5', text: 'Скільки поверхів по сходах можеш пройти без задишки?' }
            ],
            kidneys: [
                { id: 'kid_extra_1', text: 'Чи відчуваєш біль або дискомфорт в попереку?' },
                { id: 'kid_extra_2', text: 'Чи помічав зміни в обсязі сечі (занадто багато або занадто мало)?' },
                { id: 'kid_extra_3', text: 'Чи є у тебе спрага більше звичайного?' },
                { id: 'kid_extra_4', text: 'Чи спостерігав підвищення артеріального тиску без інших причин?' },
                { id: 'kid_extra_5', text: 'Чи бувають головні болі, пов\'язані з недостатнім споживанням рідини?' }
            ],
            insulin: [
                { id: 'ins_extra_1', text: 'Скільки солодкого ви вживаєте щодня (цукор, випічка, солодкі напої)?' },
                { id: 'ins_extra_2', text: 'Чи були випадки діагнозу «предіабет» або «інсулінорезистентність»?' },
                { id: 'ins_extra_3', text: 'Чи спостерігаєте ви зміну ваги без зміни харчування?' },
                { id: 'ins_extra_4', text: 'Чи є у вас ділянки темнішої шкіри (на шиї, під пахвами, між пальцями)?' },
                { id: 'ins_extra_5', text: 'Чи є діабет або ІР в сімейному анамнезі?' }
            ],
            breathing: [
                { id: 'bre_extra_1', text: 'Чи відчуваєте ви сухість у роті вранці після пробудження?' },
                { id: 'bre_extra_2', text: 'Чи помічали близькі зупинки дихання під час вашого сну?' },
                { id: 'bre_extra_3', text: 'Чи маєте ви викривлення носової перегородки або поліпи?' },
                { id: 'bre_extra_4', text: 'Чи користуєтесь ви CPAP-апаратом або іншими засобами для сну?' },
                { id: 'bre_extra_5', text: 'Чи відчуваєте втому навіть після "повноцінного" 8-годинного сну?' }
            ],
            activity: [
                { id: 'act_extra_1', text: 'Скільки годин на день ви проводите в сидячому положенні?' },
                { id: 'act_extra_2', text: 'Чи займаєтесь ви регулярними фізичними вправами?' },
                { id: 'act_extra_3', text: 'Чи відчуваєте ви задишку при підйомі на 2-3 поверх?' },
                { id: 'act_extra_4', text: 'Чи користуєтесь ви ліфтом замість сходів?' },
                { id: 'act_extra_5', text: 'Чи відчуваєте ви біль у спині після тривалого сидіння?' }
            ]
        };

        // Продающі тексти для кожної системи
        const systemSellingTexts = {
            serotonin: {
                title: "😌 Серотонін - твоє щастя під контролем",
                text: "Серотонін дає нам звичайний рівень радості, впливає на ментальне самопочуття, щастя і задоволення від життя. Не кради в себе щастя! При низькому серотоніні швидко відбувається акт еякуляції під час сексу. Підйомом серотоніну можна продовжити тривалість статевого акту.",
                practices: ["Не читай погані новини", "Не дивись UFC/бокс надто часто", "Більше сонця та вітаміну D3", "Триптофан з їжі"]
            },
            dopamine: {
                title: "🎯 Дофамін - твій внутрішній двигун",
                text: "Дофамін - це те, що нас запалює! Він понижає пролактин, підвищує сексуальне бажання. Успіх в житті напряму залежить від рівня дофаміну. Це мотивація, драйв та здатність досягати цілей.",
                practices: ["Ставити та досягати маленькі цілі", "Займатись спортом", "Обмежити швидкі задоволення", "Здорова конкуренція"]
            },
            acetylcholine: {
                title: "🧩 Ацетилхолін - скачок у твоєму житті",
                text: "Ацетилхолін дасть скачок в житті у вигляді знань, які допоможуть покращити життя. Когнітивні функції, пам'ять, навчання - все це залежить від ацетилхоліну.",
                practices: ["Яйця та лецитин", "Нові навички", "Читання", "Головоломки"]
            },
            testosterone: {
                title: "💪 Тестостерон - король гормонів",
                text: "Тестостерон - це домінантність, статева функція, бажання і можливість щось робити, змінювати в житті. Без достатнього тестостерону чоловік не відчуває себе чоловіком.",
                practices: ["Силові тренування", "Якісний сон", "Цинк та магній", "Здоровий жир в раціоні"]
            },
            liver: {
                title: "🔄 Печінка - твоя енергетична станція",
                text: "Печінка впливає на стан енергії та вільний тестостерон, який є надважливим. Вона відповідає за засвоюваність ферментів та детоксикацію організму.",
                practices: ["NAC та розторопша", "Відмова від алкоголю", "Детокс травами", "Правильне харчування"]
            },
            digestive_system: {
                title: "🍽️ ШКТ - твій другий мозок",
                text: "80% серотоніну виробляється в кишечнику! ШКТ - це наш другий мозок, який контролює настрій, імунітет та загальне самопочуття.",
                practices: ["Пробіотики", "Клітковина щодня", "Відмова від солодкого", "Якісна вода"]
            },
            kidneys: {
                title: "🚰 Нирки та простата - без нічних походів",
                text: "Вставання в туалет вночі руйнує наш мозок, сон та відновлення. Здорові нирки та простата = якісний сон = високий тестостерон.",
                practices: ["Контроль споживання рідини ввечері", "Журавлина", "Регулярні обстеження", "Захист від холоду"]
            }
        };

        // Дієти
        const dietPlans = {
            muscleBuild: {
                title: '🏋️‍♂️ Дієта для набору м\'язової маси',
                description: 'Оптимальне харчування для максимального росту м\'язів',
                target: 'Молоді чоловіки до 35 років, активні спортсмени',
                tags: ['Набір маси', 'Спорт', 'Чоловіки']
            },
            men35Plus: {
                title: '👨‍🦳 Раціон для чоловіків 35+',
                description: 'Збалансоване харчування для підтримки здоров\'я та форми після 35',
                target: 'Чоловіки 35+ років, офісні працівники, помірна активність',
                tags: ['35+', 'Здоров\'я', 'Баланс']
            },
            cutting: {
                title: '🔥 Раціон для "сушки" / рекомпозиції тіла',
                description: 'Спалювання жиру при збереженні м\'язової маси',
                target: 'Для зниження % жиру, покращення рельєфу',
                tags: ['Схуднення', 'Рельєф', 'Сушка']
            },
            womenDaily: {
                title: '👩 Жіночий щоденний раціон',
                description: 'Збалансоване харчування для жінок',
                target: 'Жінки, підтримка форми, гормональний баланс',
                tags: ['Жінки', 'Баланс', 'Здоров\'я']
            },
            womenGain: {
                title: '📈 Жіноча дієта для набору ваги',
                description: 'Здоровий набір маси для жінок',
                target: 'Жінки з дефіцитом ваги',
                tags: ['Жінки', 'Набір ваги', 'Здоров\'я']
            }
        };

        // Функції навігації
        let navigationHistory = [];

        function goBack() {
            if (navigationHistory.length > 0) {
                const previousScreen = navigationHistory.pop();
                showScreen(previousScreen, false);
            } else {
                showScreen('menu-screen', false);
            }
        }

        function showScreen(screenId, addToHistory = true) {
            if (addToHistory && currentScreen !== 'menu') {
                navigationHistory.push(currentScreen + '-screen');
            }
            
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
            currentScreen = screenId.replace('-screen', '');
            
            // Показати/сховати кнопку назад
            const backButton = document.getElementById('backButton');
            if (currentScreen === 'menu') {
                backButton.classList.add('hidden');
            } else {
                backButton.classList.remove('hidden');
            }
            
            setTimeout(() => scrollToTop(false), 100);
        }

        function scrollToTop(smooth = true) {
            if (smooth) {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            } else {
                window.scrollTo(0, 0);
            }
        }

        function handleMenuClick(menuId) {
            switch(menuId) {
                case 'test':
                    if (hasCompletedTest() && !canRetakeTest()) {
                        showRetakeWarning();
                    } else {
                        startTest();
                    }
                    break;
                case 'cabinet':
                    if (hasCompletedTest()) {
                        showMyCabinet();
                    } else {
                        alert('Спочатку пройдіть тест для створення особистого кабінету!');
                    }
                    break;
                case 'diet':
                    showDietSection();
                    break;
                case 'pharma':
                    showPharmaSection();
                    break;
                case 'consultation':
                    showConsultationSection();
                    break;
                default:
                    showComingSoon(menuId);
            }
        }

        function startTest() {
            showScreen('profile-screen');
        }

        function startTestQuestions() {
            userProfile.name = document.getElementById('userName').value;
            userProfile.age = document.getElementById('userAge').value;
            userProfile.gender = document.getElementById('userGender').value;
            userProfile.bodyType = document.getElementById('userBodyType').value;
            userProfile.height = document.getElementById('userHeight').value;
            userProfile.weight = document.getElementById('userWeight').value;

            if (!userProfile.name || !userProfile.age || !userProfile.gender || 
                !userProfile.bodyType || !userProfile.height || !userProfile.weight) {
                alert('Будь ласка, заповніть всі поля!');
                return;
            }

            currentBlock = 0;
            showScreen('test-screen');
            showTestBlock();
        }

        function getAvailableBlocks() {
            const blocks = [];
            
            Object.entries(healthBlocks).forEach(([key, block]) => {
                if (block.genderSpecific) {
                    if (block.genderSpecific === userProfile.gender) {
                        blocks.push([key, block]);
                    }
                } else {
                    blocks.push([key, block]);
                }
            });
            
            return blocks;
        }

        function showTestBlock() {
            const availableBlocks = getAvailableBlocks();
            
            if (currentBlock >= availableBlocks.length) {
                showResults();
                return;
            }

            const [blockKey, blockData] = availableBlocks[currentBlock];
            
            const isExtraQuestions = answers[`${blockKey}_needs_extra`];
            let currentQuestions;
            
            if (isExtraQuestions && extraQuestions[blockKey]) {
                // ВИПРАВЛЕНО: Показуємо ТІЛЬКИ додаткові питання, без повторення основних
                currentQuestions = extraQuestions[blockKey];
            } else {
                currentQuestions = blockData.questions;
            }
            
            const progress = ((currentBlock + 1) / availableBlocks.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `📍 Прогрес: ${currentBlock + 1}/${availableBlocks.length}`;
            
            const titleSuffix = isExtraQuestions ? ' (Детальний аналіз)' : '';
            document.getElementById('blockTitle').textContent = blockData.title + titleSuffix;
            document.getElementById('blockDescription').textContent = blockData.description;
            
            const filteredQuestions = currentQuestions.filter(q => 
                !q.genderSpecific || q.genderSpecific === userProfile.gender
            );
            
            const questionsContainer = document.getElementById('questionsContainer');
            questionsContainer.innerHTML = '';
            
            filteredQuestions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-block';
                
                let optionsHTML = '';
                
                if (question.type === 'multiple_choice' || question.type === 'numeric' || 
                    question.type === 'cycle' || question.type === 'flow') {
                    optionsHTML = question.options.map(option => `
                        <button class="answer-button" onclick="selectAnswer('${question.id}', ${option.score})" 
                                data-question="${question.id}" data-value="${option.score}">
                            ${option.text}
                            ${option.comment ? `<span class="option-comment">${option.comment}</span>` : ''}
                        </button>
                    `).join('');
                } else if (question.type === 'multiple_select') {
                    optionsHTML = question.options.map(option => `
                        <label class="checkbox-option">
                            <input type="checkbox" value="${option.value}" 
                                   onchange="handleMultipleSelect('${question.id}', '${option.value}', this.checked)">
                            <span>${option.text}</span>
                        </label>
                    `).join('');
                } else {
                    optionsHTML = `
                        <button class="answer-button" onclick="selectAnswer('${question.id}', 0)" 
                                data-question="${question.id}" data-value="0">Так</button>
                        <button class="answer-button" onclick="selectAnswer('${question.id}', 1)" 
                                data-question="${question.id}" data-value="1">Інколи</button>
                        <button class="answer-button" onclick="selectAnswer('${question.id}', 2)" 
                                data-question="${question.id}" data-value="2">Ні</button>
                    `;
                }
                
                questionDiv.innerHTML = `
                    <div class="question-counter">Питання ${index + 1}/${filteredQuestions.length}</div>
                    <p class="question-text">${question.text}</p>
                    <div class="answer-options">${optionsHTML}</div>
                `;
                questionsContainer.appendChild(questionDiv);
            });
            
            const nextButton = document.getElementById('nextButton');
            nextButton.textContent = currentBlock === availableBlocks.length - 1 ? 'Завершити тест 🎯' : 'Далі ➡️';
            nextButton.disabled = true;
            
            checkAllAnswered();
        }

        function selectAnswer(questionId, value) {
            answers[questionId] = value;
            
            const buttons = document.querySelectorAll(`[data-question="${questionId}"]`);
            buttons.forEach(btn => btn.classList.remove('selected'));
            
            const selectedButton = document.querySelector(`[data-question="${questionId}"][data-value="${value}"]`);
            if (selectedButton) {
                selectedButton.classList.add('selected');
            }
            
            checkAllAnswered();
        }

        function handleMultipleSelect(questionId, value, checked) {
            if (!answers[questionId]) {
                answers[questionId] = [];
            }
            
            if (value === 'none') {
                answers[questionId] = checked ? ['none'] : [];
                const otherCheckboxes = document.querySelectorAll(`input[type="checkbox"]:not([value="none"])`);
                otherCheckboxes.forEach(cb => cb.checked = false);
            } else {
                if (checked) {
                    answers[questionId] = answers[questionId].filter(v => v !== 'none').concat(value);
                } else {
                    answers[questionId] = answers[questionId].filter(v => v !== value);
                }
                const noneCheckbox = document.querySelector(`input[value="none"]`);
                if (noneCheckbox) noneCheckbox.checked = false;
            }
            
            checkAllAnswered();
        }

        function checkAllAnswered() {
            const availableBlocks = getAvailableBlocks();
            const [blockKey, blockData] = availableBlocks[currentBlock];
            
            const isExtraQuestions = answers[`${blockKey}_needs_extra`];
            let currentQuestions;
            
            if (isExtraQuestions && extraQuestions[blockKey]) {
                currentQuestions = extraQuestions[blockKey];
            } else {
                currentQuestions = blockData.questions;
            }
            
            const filteredQuestions = currentQuestions.filter(q => 
                !q.genderSpecific || q.genderSpecific === userProfile.gender
            );
            
            const allAnswered = filteredQuestions.every(q => {
                if (q.type === 'multiple_select') {
                    return answers[q.id] && answers[q.id].length > 0;
                }
                return answers[q.id] !== undefined;
            });
            
            document.getElementById('nextButton').disabled = !allAnswered;
        }

        function needsExtraQuestions(blockKey, currentScore) {
            // ВИПРАВЛЕНО: Для активності не давати додаткові питання при високому скорі
            if (blockKey === 'activity') {
                return currentScore <= 3; // Тільки при дуже низькому скорі
            }
            
            const threshold = 5;
            return currentScore <= threshold;
        }

        function checkForAdditionalQuestions(blockKey) {
            const blockData = healthBlocks[blockKey];
            let currentScore = 0;
            
            blockData.questions.forEach(q => {
                if (answers[q.id] !== undefined) {
                    currentScore += answers[q.id];
                }
            });
            
            if (needsExtraQuestions(blockKey, currentScore) && extraQuestions[blockKey] && !answers[`${blockKey}_needs_extra`]) {
                answers[`${blockKey}_needs_extra`] = true;
                
                showProcessingMessage("Виявлено можливий дисбаланс. Потрібен детальніший аналіз...", 2000);
                
                setTimeout(() => {
                    showTestBlock();
                }, 2500);
                
                return true;
            }
            
            return false;
        }

        // Повідомлення обробки
        function showProcessingMessage(message, duration = 2000) {
            return new Promise((resolve) => {
                scrollToTop();
                
                const overlay = document.createElement('div');
                overlay.className = 'processing-overlay';
                overlay.innerHTML = `
                    <div class="processing-card">
                        <div class="processing-spinner"></div>
                        <p class="processing-text">${message}</p>
                        <div class="processing-dots">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(overlay);
                
                setTimeout(() => {
                    overlay.classList.add('visible');
                }, 100);
                
                setTimeout(() => {
                    overlay.classList.remove('visible');
                    setTimeout(() => {
                        if (overlay.parentNode) {
                            overlay.parentNode.removeChild(overlay);
                        }
                        resolve();
                    }, 300);
                }, duration);
            });
        }

        function showMultipleProcessingMessages(messages, baseDuration = 800) {
            return new Promise(async (resolve) => {
                for (let i = 0; i < messages.length; i++) {
                    const duration = baseDuration + Math.random() * 400; // Швидші анімації
                    await showProcessingMessage(messages[i], duration);
                    
                    if (i < messages.length - 1) {
                        await new Promise(r => setTimeout(r, 150)); // Зменшена пауза між анімаціями
                    }
                }
                resolve();
            });
        }

        async function nextBlockWithProcessing() {
            const availableBlocks = getAvailableBlocks();
            const [currentBlockKey, currentBlockData] = availableBlocks[currentBlock];
            
            scrollToTop();
            
            const needsExtra = checkForAdditionalQuestions(currentBlockKey);
            if (needsExtra) {
                return;
            }
            
            const processingMsgs = ['🧠 Аналізую відповіді...', '📊 Обробляю дані...'];
            await showMultipleProcessingMessages(processingMsgs);
            
            currentBlock++;
            
            if (currentBlock >= availableBlocks.length) {
                const finalMessages = ['📊 Завершую аналіз...', '🎯 Формую результати...'];
                await showMultipleProcessingMessages(finalMessages, 1000);
                showResults();
            } else {
                showTestBlock();
                setTimeout(() => scrollToTop(), 300);
            }
        }

        function calculatePessimisticScore(rawScore, maxScore, hasExtraQuestions = false) {
            const basicPercentage = (rawScore / maxScore) * 100;
            let adjustedPercentage = basicPercentage;
            
            if (hasExtraQuestions) {
                adjustedPercentage = Math.min(adjustedPercentage * 0.8, 75);
            }
            
            if (basicPercentage >= 90) {
                adjustedPercentage = Math.min(adjustedPercentage, 85);
            } else if (basicPercentage >= 80) {
                adjustedPercentage = Math.min(adjustedPercentage * 0.85, 75);
            } else if (basicPercentage >= 70) {
                adjustedPercentage = Math.min(adjustedPercentage * 0.75, 65);
            } else if (basicPercentage >= 60) {
                adjustedPercentage = Math.min(adjustedPercentage * 0.7, 55);
            } else {
                adjustedPercentage = Math.min(adjustedPercentage * 0.6, 45);
            }
            
            return Math.round(adjustedPercentage);
        }

        function showResults() {
            showScreen('results-screen');
            scrollToTop(false);
            calculateAndDisplayResults();
        }

        function calculateAndDisplayResults() {
            const results = {};
            const availableBlocks = getAvailableBlocks();
            
            availableBlocks.forEach(([key, data]) => {
                let score = 0;
                let maxScore = 0;
                
                const isExtraQuestions = answers[`${key}_needs_extra`];
                let allQuestions = data.questions;
                
                if (isExtraQuestions && extraQuestions[key]) {
                    allQuestions = [...data.questions, ...extraQuestions[key]];
                }
                
                const filteredQuestions = allQuestions.filter(q => 
                    !q.genderSpecific || q.genderSpecific === userProfile.gender
                );
                
                filteredQuestions.forEach(q => {
                    if (q.type === 'multiple_select') {
                        maxScore += 2;
                        const selectedValues = answers[q.id] || [];
                        score += (selectedValues.length === 0 || selectedValues.includes('none')) ? 2 : 0;
                    } else {
                        maxScore += 2;
                        score += answers[q.id] || 0;
                    }
                });
                
                const pessimisticPercentage = calculatePessimisticScore(score, maxScore, isExtraQuestions);
                
                results[key] = {
                    score,
                    maxScore,
                    percentage: pessimisticPercentage,
                    ...data
                };
            });

            const bmi = userProfile.weight && userProfile.height 
                ? (userProfile.weight / Math.pow(userProfile.height / 100, 2)).toFixed(1)
                : null;

            const userInfoHTML = `
                <h3>👤 ${userProfile.name}</h3>
                <p>Вік: ${userProfile.age} | Стать: ${userProfile.gender === 'male' ? 'Чоловік' : 'Жінка'}</p>
                ${bmi ? `<p>ІМТ: ${bmi} (${getBMICategory(bmi)})</p>` : ''}
            `;
            document.getElementById('userInfoResults').innerHTML = userInfoHTML;

            const neurotransmitterResults = Object.entries(results).filter(([_, r]) => r.type === 'neurotransmitter');
            
            if (neurotransmitterResults.length > 0) {
                const dominantNT = neurotransmitterResults.reduce((prev, current) => 
                    current[1].percentage > prev[1].percentage ? current : prev
                );

                const dominantHTML = `
                    <h3>✅ Домінуючий нейромедіатор:</h3>
                    <div class="dominant-card">
                        <span class="dominant-emoji">${dominantNT[1].emoji}</span>
                        <h4>${dominantNT[1].name}</h4>
                        <p>${dominantNT[1].description}</p>
                        <div class="score-bar">
                            <div class="score-fill" style="width: ${dominantNT[1].percentage}%"></div>
                        </div>
                        <span class="percentage">${Math.round(dominantNT[1].percentage)}%</span>
                    </div>
                `;
                document.getElementById('dominantResult').innerHTML = dominantHTML;
            }

            let allResultsHTML = '<h3>📊 Детальні результати:</h3>';
            
            const types = {
                'neurotransmitter': '🧠 Нейромедіатори',
                'hormone': '💉 Гормони',
                'system': '🏥 Системи організму',
                'metabolic': '⚡ Метаболічні показники',
                'lifestyle': '🌟 Спосіб життя',
                'medical': '🩺 Медичні показники'
            };

            Object.entries(types).forEach(([type, title]) => {
                const typeResults = Object.entries(results).filter(([_, r]) => r.type === type);
                if (typeResults.length > 0) {
                    allResultsHTML += `<div class="result-category"><h4>${title}</h4>`;
                    typeResults.forEach(([key, result]) => {
                        const status = getStatusColor(result.percentage);
                        allResultsHTML += `
                            <div class="result-item">
                                <div class="result-header">
                                    <span class="result-name">${result.emoji} ${result.name}</span>
                                    <span class="result-percentage ${status}">${Math.round(result.percentage)}%</span>
                                </div>
                                <div class="score-bar-small">
                                    <div class="score-fill ${status}" style="width: ${result.percentage}%"></div>
                                </div>
                                ${result.percentage < 75 ? `
                                <div class="selling-text">
                                    ${getSystemSellingText(key) ? `
                                        <h5>${getSystemSellingText(key).title}</h5>
                                        <p>${getSystemSellingText(key).text}</p>
                                        <div class="basic-practices">
                                            <strong>📋 Базові практики:</strong>
                                            <ul>
                                                ${getSystemSellingText(key).practices.map(practice => `<li>${practice}</li>`).join('')}
                                            </ul>
                                        </div>
                                    ` : ''}
                                    <div class="upgrade-cta">
                                        <p><strong>💎 Список аналізів і стеки добавок, підібрані для вас на основі АІ агента, чекають в розширеній версії</strong></p>
                                        <button onclick="showUpgradeOffer()" class="details-btn upgrade-cta-btn">
                                            Детальніше про ${result.name}
                                        </button>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        `;
                    });
                    allResultsHTML += '</div>';
                }
            });

            document.getElementById('allResults').innerHTML = allResultsHTML;
            
            // Зберігаємо результати
            saveTestResults(userProfile, answers, results, []);
        }

        function getBMICategory(bmi) {
            if (bmi < 18.5) return 'Недостатня вага';
            if (bmi < 25) return 'Нормальна вага';
            if (bmi < 30) return 'Надмірна вага';
            return 'Ожиріння';
        }

        function getStatusColor(percentage) {
            if (percentage >= 75) return 'good';
            if (percentage >= 50) return 'warning';
            return 'danger';
        }

        function getSystemSellingText(systemKey) {
            return systemSellingTexts[systemKey] || null;
        }

        // Клас для збереження результатів
        class TestResults {
            constructor(userProfile, answers, results, warnings) {
                this.id = Date.now().toString();
                this.completionDate = new Date().toISOString();
                this.userProfile = { ...userProfile };
                this.answers = { ...answers };
                this.results = { ...results };
                this.warnings = warnings || [];
                this.recommendations = this.generateRecommendations();
                this.nextTestDate = this.calculateNextTestDate();
            }
            
            generateRecommendations() {
                const recommendations = {
                    immediate: [],
                    supplements: [],
                    lifestyle: [],
                    medical: [],
                    monitoring: []
                };
                
                Object.entries(this.results).forEach(([blockKey, result]) => {
                    if (result.percentage < 60) {
                        if (result.recommendations) {
                            recommendations.immediate.push(...result.recommendations.slice(0, 2));
                        }
                        
                        if (result.percentage < 40) {
                            recommendations.medical.push(`Консультація спеціаліста по ${result.name}`);
                        }
                    }
                });
                
                return recommendations;
            }
            
            calculateNextTestDate() {
                const nextDate = new Date();
                nextDate.setMonth(nextDate.getMonth() + 6);
                return nextDate.toISOString();
            }
            
            getHealthScore() {
                const scores = Object.values(this.results).map(r => r.percentage);
                return Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
            }
            
            getCriticalAreas() {
                return Object.entries(this.results)
                    .filter(([_, result]) => result.percentage < 50)
                    .map(([key, result]) => ({
                        name: result.name,
                        percentage: result.percentage,
                        emoji: result.emoji,
                        type: result.type
                    }));
            }
        }

        // Функції збереження результатів
        function saveTestResults(userProfile, answers, results, warnings) {
            userTestResults = new TestResults(userProfile, answers, results, warnings);
            testCompletionDate = new Date();
            
            // Зберігаємо в MongoDB
            const dataToSave = {
                userId: tg?.initDataUnsafe?.user?.id || 'anonymous',
                results: userTestResults,
                timestamp: new Date()
            };
            saveToMongoDB(dataToSave);
            
            return userTestResults;
        }

        function hasCompletedTest() {
            return userTestResults !== null;
        }

        function getTestResults() {
            return userTestResults;
        }

        function canRetakeTest() {
            if (!testCompletionDate) return true;
            const daysSinceTest = (Date.now() - testCompletionDate.getTime()) / (1000 * 60 * 60 * 24);
            return daysSinceTest >= 30;
        }

        function showRetakeWarning() {
            const daysSinceTest = Math.floor((Date.now() - testCompletionDate.getTime()) / (1000 * 60 * 60 * 24));
            const daysUntilRetake = 30 - daysSinceTest;
            
            const warningHTML = `
                <div class="retake-warning">
                    <h3>⏳ Тест вже пройдено</h3>
                    <p>Ви проходили тест ${daysSinceTest} днів тому.</p>
                    <p>Наступний тест можна буде пройти через <strong>${daysUntilRetake} днів</strong>.</p>
                    <p>Це допоможе отримати більш точні результати та відстежити динаміку змін.</p>
                    <div class="warning-actions">
                        <button onclick="showMyCabinet()" class="continue-button">
                            📊 Переглянути мої результати
                        </button>
                        <button onclick="backToMenu()" class="secondary-button">
                            🏠 Повернутися до меню
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('test-screen').innerHTML = warningHTML;
            showScreen('test-screen');
        }

        // Мій кабінет
        function showMyCabinet() {
            if (!hasCompletedTest()) {
                alert('Спочатку пройдіть тест для створення особистого кабінету!');
                return;
            }
            
            const results = getTestResults();
            const cabinetHTML = generateCabinetHTML(results);
            
            let cabinetScreen = document.getElementById('cabinet-screen');
            if (!cabinetScreen) {
                cabinetScreen = document.createElement('div');
                cabinetScreen.id = 'cabinet-screen';
                cabinetScreen.className = 'screen hidden';
                document.querySelector('.app').appendChild(cabinetScreen);
            }
            
            cabinetScreen.innerHTML = cabinetHTML;
            showScreen('cabinet-screen');
        }

        function generateCabinetHTML(results) {
            const healthScore = results.getHealthScore();
            const criticalAreas = results.getCriticalAreas();
            
            return `
                <div class="cabinet-container">
                    <header class="cabinet-header">
                        <h1>👤 Мій кабінет</h1>
                        <p class="subtitle">Персональна панель здоров'я</p>
                    </header>
                    
                    <div class="health-overview">
                        <h2>📊 Загальний стан здоров'я</h2>
                        <div class="health-score-card">
                            <div class="score-circle ${getScoreClass(healthScore)}">
                                <span class="score-number">${healthScore}</span>
                                <span class="score-label">балів</span>
                            </div>
                            <div class="score-description">
                                <h3>${getHealthStatusTitle(healthScore)}</h3>
                                <p>${getHealthStatusDescription(healthScore)}</p>
                                <small>Останнє оновлення: ${formatDate(results.completionDate)}</small>
                            </div>
                        </div>
                    </div>
                    
                    ${criticalAreas.length > 0 ? `
                        <div class="critical-areas">
                            <h2>⚠️ Потребують уваги</h2>
                            <div class="critical-grid">
                                ${criticalAreas.map(area => `
                                    <div class="critical-card">
                                        <span class="critical-emoji">${area.emoji}</span>
                                        <h4>${area.name}</h4>
                                        <div class="critical-score">${area.percentage}%</div>
                                        <button onclick="showUpgradeOffer()" class="details-btn">
                                            Детальніше
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="quick-actions">
                        <h2>🚀 Швидкі дії</h2>
                        <div class="actions-grid">
                            <button onclick="showUpgradeOffer()" class="action-card">
                                <span class="action-icon">💊</span>
                                <span class="action-title">Мої рекомендації</span>
                                <span class="action-subtitle">${results.recommendations.immediate.length} активних</span>
                            </button>
                            
                            <button onclick="showUpgradeOffer()" class="action-card">
                                <span class="action-icon">📋</span>
                                <span class="action-title">План добавок</span>
                                <span class="action-subtitle">Персональний курс</span>
                            </button>
                            
                            <button onclick="showUpgradeOffer()" class="action-card">
                                <span class="action-icon">📈</span>
                                <span class="action-title">Історія тестів</span>
                                <span class="action-subtitle">Відстеження прогресу</span>
                            </button>
                            
                            <button onclick="scheduleConsultation()" class="action-card">
                                <span class="action-icon">👨‍⚕️</span>
                                <span class="action-title">Консультація</span>
                                <span class="action-subtitle">Запис до спеціаліста</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="next-test">
                        <h2>📅 Наступний тест</h2>
                        <div class="next-test-card">
                            <p>Рекомендована дата: <strong>${formatDate(results.nextTestDate)}</strong></p>
                            <p>Регулярні тести допомагають відстежувати прогрес та коригувати план лікування.</p>
                            ${canRetakeTest() ? `
                                <button onclick="startTest()" class="continue-button">
                                    🔄 Пройти тест знову
                                </button>
                            ` : `
                                <button class="secondary-button" disabled>
                                    ⏳ Зачекайте до рекомендованої дати
                                </button>
                            `}
                        </div>
                    </div>
                    
                    <button onclick="backToMenu()" class="back-to-menu">
                        🏠 Повернутися до меню
                    </button>
                </div>
            `;
        }

        function getScoreClass(score) {
            if (score >= 75) return 'excellent';
            if (score >= 60) return 'good';
            if (score >= 45) return 'warning';
            return 'critical';
        }

        function getHealthStatusTitle(score) {
            if (score >= 75) return 'Відмінний стан';
            if (score >= 60) return 'Хороший стан';
            if (score >= 45) return 'Потребує покращення';
            return 'Критичний стан';
        }

        function getHealthStatusDescription(score) {
            if (score >= 75) return 'Ваше здоров\'я в чудовому стані! Продовжуйте дотримуватися здорового способу життя.';
            if (score >= 60) return 'Загалом непогано, але є кілька моментів для покращення.';
            if (score >= 45) return 'Виявлені проблемні зони, рекомендується звернути увагу на рекомендації.';
            return 'Серйозні проблеми зі здоров\'ям. Необхідна консультація спеціаліста.';
        }

        function formatDate(isoString) {
            const date = new Date(isoString);
            return date.toLocaleDateString('uk-UA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function scheduleConsultation() {
            window.open('https://t.me/vladyslav_kravchukk', '_blank');
        }

        // Типажі користувачів
        function getUserType() {
            const age = parseInt(userProfile.age?.split('-')[0] || '25');
            const height = parseInt(userProfile.height) || 170;
            const weight = parseInt(userProfile.weight) || 70;
            const bmi = weight / Math.pow(height / 100, 2);
            
            let type = {
                age_group: age < 25 ? 'young' : age < 35 ? 'adult' : age < 50 ? 'middle' : 'senior',
                body_type: userProfile.bodyType,
                bmi_category: bmi < 18.5 ? 'underweight' : bmi < 25 ? 'normal' : bmi < 30 ? 'overweight' : 'obese',
                gender: userProfile.gender
            };
            
            return type;
        }

        function getPersonalizedDietPlan() {
            const userType = getUserType();
            
            if (userType.bmi_category === 'underweight') {
                return 'womenGain';
            } else if (userType.bmi_category === 'overweight' || userType.bmi_category === 'obese') {
                return 'cutting';
            } else if (userType.body_type === 'athletic' && userType.age_group === 'young') {
                return 'muscleBuild';
            } else if (userType.age_group === 'middle' || userType.age_group === 'senior') {
                return userType.gender === 'male' ? 'men35Plus' : 'womenDaily';
            } else {
                return userType.gender === 'male' ? 'men35Plus' : 'womenDaily';
            }
        }

        // Дієти
        function showDietSection() {
            const userType = getUserType();
            const recommendedDiet = getPersonalizedDietPlan();
            
            const dietHTML = `
                <div class="diet-section">
                    <h2>🥗 Персональні дієти</h2>
                    
                    ${hasCompletedTest() ? `
                        <div class="recommended-diet">
                            <h3>✅ Рекомендована для вас дієта:</h3>
                            <div class="diet-card featured" onclick="showDietDetails('${recommendedDiet}')">
                                <h4>${dietPlans[recommendedDiet]?.title}</h4>
                                <p>${dietPlans[recommendedDiet]?.description}</p>
                                <div class="diet-tags">
                                    ${dietPlans[recommendedDiet]?.tags.map(tag => `<span class="diet-tag">${tag}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="diet-menu">
                        <h3>📋 Всі доступні дієти:</h3>
                        
                        ${Object.entries(dietPlans).map(([key, diet]) => `
                            <div class="diet-card" onclick="showDietDetails('${key}')">
                                <h4>${diet.title}</h4>
                                <p>${diet.description}</p>
                                <small>Для: ${diet.target}</small>
                                <div class="diet-tags">
                                    ${diet.tags.map(tag => `<span class="diet-tag">${tag}</span>`).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="diet-cta">
                        <p>💎 Детальні плани харчування з рецептами та розкладом доступні в розширеній версії</p>
                        <button onclick="showUpgradeOffer()" class="upgrade-button">
                            Отримати повні плани дієт
                        </button>
                    </div>
                    
                    <button onclick="backToMenu()" class="back-to-menu">
                        🏠 Повернутися до меню
                    </button>
                </div>
            `;
            
            showCustomScreen(dietHTML);
        }

        function showDietDetails(dietKey) {
            const diet = dietPlans[dietKey];
            if (!diet) return;
            
            alert(`Детальний план дієти "${diet.title}" доступний в розширеній версії.\n\nОтримайте повний план харчування з рецептами, розкладом та рекомендаціями спеціаліста.`);
        }

        // Розширена версія
        function showUpgradeOffer() {
            const upgradeHTML = `
                <div class="upgrade-offer">
                    <h2>🚀 Розширена версія PantelMed AI</h2>
                    
                    <div class="upgrade-benefits">
                        <h3>Що ви отримаєте:</h3>
                        
                        <div class="benefit-item">
                            <span class="benefit-icon">💊</span>
                            <div class="benefit-content">
                                <h4>Персональні стеки добавок</h4>
                                <p>Детальні схеми прийому з дозуванням та тривалістю курсів</p>
                            </div>
                        </div>
                        
                        <div class="benefit-item">
                            <span class="benefit-icon">🔄</span>
                            <div class="benefit-content">
                                <h4>Вилки взаємодії систем</h4>
                                <p>Розуміння, як різні системи організму впливають одна на одну</p>
                            </div>
                        </div>
                        
                        <div class="benefit-item">
                            <span class="benefit-icon">👨‍⚕️</span>
                            <div class="benefit-content">
                                <h4>Консультація спеціаліста</h4>
                                <p>30-хвилинна консультація з інтерпретації результатів</p>
                            </div>
                        </div>
                        
                        <div class="benefit-item">
                            <span class="benefit-icon">📊</span>
                            <div class="benefit-content">
                                <h4>Моніторинг прогресу</h4>
                                <p>Відстеження змін та корекція рекомендацій</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pricing">
                        <div class="price-card">
                            <h3>💎 Розширений пакет</h3>
                            <div class="price">1299 грн</div>
                            <p class="price-description">Все включено + консультація</p>
                        </div>
                    </div>
                    
                    <div class="upgrade-actions">
                        <a href="https://t.me/vladyslav_kravchukk" 
                           target="_blank" class="upgrade-btn primary">
                            💳 Замовити розширену версію
                        </a>
                        <button onclick="backToMenu()" class="upgrade-btn secondary">
                            ← Повернутися до безкоштовної версії
                        </button>
                    </div>
                </div>
            `;
            
            showCustomScreen(upgradeHTML);
        }

        // Секції меню
        function showConsultationSection() {
            const consultationHTML = `
                <div class="consultation-section">
                    <h2>👨‍⚕️ Консультація спеціаліста</h2>
                    
                    <div class="specialist-card">
                        <div class="specialist-info">
                            <h3>${consultationConfig.specialistName}</h3>
                            <p>${consultationConfig.specialistTitle}</p>
                        </div>
                        
                        <div class="consultation-types">
                            <h4>💼 Типи консультацій:</h4>
                            
                            <div class="consultation-option">
                                <h5>📞 Базова консультація - 799 грн</h5>
                                <ul>
                                    <li>Аналіз результатів тесту</li>
                                    <li>Індивідуальні рекомендації</li>
                                    <li>План обстежень</li>
                                    <li>Тривалість: 45 хвилин</li>
                                </ul>
                            </div>
                            
                            <div class="consultation-option">
                                <h5>💎 Розширена консультація - 1299 грн</h5>
                                <ul>
                                    <li>Детальний аналіз всіх систем</li>
                                    <li>Персональний план на 3 місяці</li>
                                    <li>Підбір добавок з схемами прийому</li>
                                    <li>Супровід протягом місяця</li>
                                    <li>Тривалість: 90 хвилин</li>
                                </ul>
                            </div>
                            
                            <div class="consultation-option premium">
                                <h5>👑 VIP супровід - 2499 грн</h5>
                                <ul>
                                    <li>Щотижневі консультації (3 місяці)</li>
                                    <li>Постійна корекція програми</li>
                                    <li>Аналіз динаміки змін</li>
                                    <li>Зв'язок 24/7</li>
                                    <li>Пріоритетна підтримка</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="contact-buttons">
                            <a href="https://t.me/${consultationConfig.specialistTelegram.replace('@', '')}" 
                               target="_blank" class="contact-btn primary">
                                📱 Написати в Telegram
                            </a>
                        </div>
                    </div>
                    
                    <button onclick="backToMenu()" class="back-to-menu">
                        🏠 Повернутися до меню
                    </button>
                </div>
            `;
            
            showCustomScreen(consultationHTML);
        }

        function showPharmaSection() {
            const pharmaHTML = `
                <div class="pharma-section">
                    <h2>💊💉 Фармакологія та добавки</h2>
                    
                    <div class="pharma-warning">
                        <h3>⚠️ Важливо!</h3>
                        <p>Всі фармакологічні препарати повинні призначатися тільки лікарем після обстеження!</p>
                    </div>
                    
                    <div class="pharma-categories">
                        <div class="pharma-category">
                            <h4>💊 БАДи та нутрицевтики</h4>
                            <p>Натуральні добавки для підтримки здоров'я</p>
                            <ul>
                                <li>Вітаміни та мінерали</li>
                                <li>Адаптогени</li>
                                <li>Омега-3 та амінокислоти</li>
                                <li>Пробіотики</li>
                            </ul>
                        </div>
                        
                        <div class="pharma-category">
                            <h4>💉 Гормональна терапія</h4>
                            <p>Тільки під наглядом лікаря</p>
                            <ul>
                                <li>Замісна гормональна терапія</li>
                                <li>Пептидні препарати</li>
                                <li>Інсулінова терапія</li>
                                <li>Тиреоїдні гормони</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="consultation-cta">
                        <p>Для підбору індивідуальної схеми звертайтесь до спеціаліста:</p>
                        <a href="https://t.me/${consultationConfig.specialistTelegram.replace('@', '')}" 
                           target="_blank" class="cta-button">
                            📱 Консультація ${consultationConfig.specialistName}
                        </a>
                    </div>
                    
                    <button onclick="backToMenu()" class="back-to-menu">
                        🏠 Повернутися до меню
                    </button>
                </div>
            `;
            
            showCustomScreen(pharmaHTML);
        }

        function showCustomScreen(htmlContent) {
            let customScreen = document.getElementById('custom-screen');
            if (!customScreen) {
                customScreen = document.createElement('div');
                customScreen.id = 'custom-screen';
                customScreen.className = 'screen hidden';
                document.querySelector('.app').appendChild(customScreen);
            }
            
            customScreen.innerHTML = htmlContent;
            showScreen('custom-screen');
        }

        function showComingSoon(featureName) {
            const comingSoonHTML = `
                <div class="coming-soon-section">
                    <h2>🚧 ${featureName}</h2>
                    <div class="coming-soon-content">
                        <div class="construction-icon">⚙️</div>
                        <h3>Розділ в розробці</h3>
                        <p>Ми працюємо над цією функцією. Незабаром вона буде доступна!</p>
                        
                        <div class="notify-section">
                            <p>Хочете дізнатися першими про запуск?</p>
                            <a href="https://t.me/${consultationConfig.specialistTelegram.replace('@', '')}" 
                               target="_blank" class="notify-btn">
                                🔔 Підписатися на оновлення
                            </a>
                        </div>
                    </div>
                    
                    <button onclick="backToMenu()" class="back-to-menu">
                        🏠 Повернутися до меню
                    </button>
                </div>
            `;
            
            showCustomScreen(comingSoonHTML);
        }

        function backToMenu() {
            showScreen('menu-screen', false);
            currentBlock = 0;
            answers = {};
        }

        // MongoDB інтеграція - заглушки
        async function loadSavedData() {
            console.log('Завантаження збережених даних...');
        }

        async function saveToMongoDB(data) {
            console.log('Збереження в MongoDB:', data);
        }

        // Ініціалізація при завантаженні
        document.addEventListener('DOMContentLoaded', function() {
            showScreen('menu-screen', false);
            
            if (tg && tg.initDataUnsafe?.user?.first_name) {
                document.getElementById('userName').value = tg.initDataUnsafe.user.first_name;
            }

            loadSavedData();
        });

        // Валідація форми профілю
        document.addEventListener('input', function(e) {
            if (e.target.closest('#profile-screen')) {
                const name = document.getElementById('userName').value;
                const age = document.getElementById('userAge').value;
                const gender = document.getElementById('userGender').value;
                const bodyType = document.getElementById('userBodyType').value;
                const height = document.getElementById('userHeight').value;
                const weight = document.getElementById('userWeight').value;
                
                const allFilled = name && age && gender && bodyType && height && weight;
                document.querySelector('#profile-screen .continue-button').disabled = !allFilled;
            }
        });
    </script>
</body>
</html>
